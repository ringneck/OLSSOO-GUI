<!--
 * Asterisk-GUI	- an Asterisk configuration interface
 *
 * Configure directory/Application paths used by GUI
 *
 * Copyright (C) 2008, Digium, Inc.
 *
 * Pari Nannapaneni <pari@digium.com>
 *
 * See http://www.asterisk.org for more information about
 * the Asterisk project. Please do not directly contact
 * any of the maintainers of this project for assistance;
 * the project provides a web site, mailing lists and IRC
 * channels for your use.
 *
 * This program is free software, distributed under the terms of
 * the GNU General Public License Version 2. See the LICENSE file
 * at the top of the source tree.
 *
-->
<script src="js/jquery.js"></script>
<script src="js/astman.js"></script>
<script>

var PINGINTERVAL = 10 * 1000 ;

var keepPinging = function(){
	var makePingRequest = function(){
		$.ajax({
			type: 'GET',
			url: ASTGUI.paths.rawman,
			data: 'action=ping',
			success: function(t) {
				if( !t.toLowerCase().contains('pong') ){
					clearInterval( KEEPPINGING );
					alert('Session Expired!');
				}
			},
			error: function(){}
		});
	};
	makePingRequest();
	KEEPPINGING = setInterval( makePingRequest, PINGINTERVAL);
};


var doLogin = function(){
	var f = makeSyncRequest({ action :'login', username: _$('username').value, secret: _$('secret').value });
	f = f.toLowerCase();
	if( f.contains('authentication accepted') ){
		keepPinging();
		$('#Login_form').hide();
	}else if(f.match('authentication failed') ) {
		alert('Invalid Username or Password');
	}
};

var localajaxinit = function(){

};






</script>
<body>

	<div id="NoScriptWarning"><noscript>You need to enable Javascript in your browser !!</noscript></div>

	<div id='Login_form'>
	<table align="center">
		<tr>	<td colspan="2"><BR></td>
		<tr>	<td align=right>Username:</td>
			<td><input id="username" size=12></td>
		</tr>
		<tr>	<td align=right>Password:</td>
			<td><input type="password" id="secret" size=12></td>
		</tr>
		<tr>	<td align='center' colspan='2'>
				<button onclick="doLogin();">Login</button> 
			</td>
		</tr>
	</table>
	</div>

</body>