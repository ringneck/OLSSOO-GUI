<!--
 * Asterisk-GUI	- an Asterisk configuration interface
 *
 * Add/delete/Edit "Users"
 *
 * Copyright (C) 2006 - 2008, Digium, Inc.
 *
 * Mark Spencer <markster@digium.com> 
 * Pari Nannapaneni <pari@digium.com>
 *
 * See http://www.asterisk.org for more information about
 * the Asterisk project. Please do not directly contact
 * any of the maintainers of this project for assistance;
 * the project provides a web site, mailing lists and IRC
 * channels for your use.
 *
 * This program is free software, distributed under the terms of
 * the GNU General Public License Version 2. See the LICENSE file
 * at the top of the source tree.
 *
-->
<script src="js/jquery.js"></script>
<script src="js/astman.js"></script>
<script src="js/jquery.tooltip.js"></script>
<link href="stylesheets/schwing.css" media="all" rel="Stylesheet" type="text/css" />
<style type="text/css">
	.no_obcid{ color: #FF0000; }
	#table_userslist {
		border: 1px solid #666666;
		margin-top: 5px;
		margin-bottom:10px;
		width: 96%;
		text-align: center;
		padding : 1px;
	}
	#table_userslist tr.frow { background: #6b79a5; color: #CED7EF; }
	#table_userslist tr.frow td{ font-weight:bold; }
	#table_userslist tr td{ padding : 3px; }
	#table_userslist tr.even { background: #DFDFDF; }
	#table_userslist tr.odd{ background: #FFFFFF; }
	#table_userslist tr.even:hover, #table_userslist tr.odd:hover {
		background: #a8b6e5;
		cursor: default;
	}

</style>
<script>
var isNewUSER;
var EXTENSION_EDIT;
var zapchan_Before = '';
var MULTI_FIELDS = ['edit_check_multiple_obcid','edit_multiple_obcid','edit_check_multiple_dialplan','edit_multiple_dialplan','edit_check_multiple_hasvoicemail','edit_multiple_hasvoicemail','edit_check_multiple_vmsecret', 'edit_multiple_vmCHoice1', 'edit_multiple_vmCHoice2', 'edit_multiple_vmsecret', 'edit_check_multiple_hassip', 'edit_multiple_hassip', 'edit_check_multiple_hasiax', 'edit_multiple_hasiax', 'edit_check_multiple_allow',  'edit_multiple_codec_one', 'edit_multiple_codec_two', 'edit_multiple_codec_three', 'edit_multiple_codec_fourth', 'edit_multiple_codec_fifth', 'edit_check_multiple_flashrxflash',  'edit_multiple_flash', 'edit_multiple_rxflash', 'edit_check_multiple_secret', 'edit_multiple_seCHoice1', 'edit_multiple_seCHoice2', 'edit_multiple_secret', 'edit_check_multiple_nat',  'edit_multiple_nat', 'edit_check_multiple_canreinvite', 'edit_multiple_canreinvite', 'edit_check_multiple_dtmfmode',  'edit_multiple_dtmfmode', 'edit_check_multiple_insecure',  'edit_multiple_insecure', 'edit_check_multiple_3waycalling',  'edit_multiple_3waycalling', 'edit_check_multiple_indirectory',  'edit_multiple_indirectory', 'edit_check_multiple_callwaiting',  'edit_multiple_callwaiting', 'edit_check_multiple_cti',  'edit_multiple_cti', 'edit_check_multiple_isagent',  'edit_multiple_isagent', 'edit_check_multiple_pickupgroup',  'edit_multiple_pickupgroup'];


var localajaxinit = function(){
	top.document.title = 'Manage User Extensions ' ;
	if( !ASTGUI.miscFunctions.alertIfRangeisNotdefined('ue_start','ue_end', 'Users') ){
		$('.top_buttons').hide();
		return;
	}
	USERS_MISC_FUNCTIONS.load_users_table();
	$('#whereToBuy_button').tooltip({delay:0.9,showURL:false,top:15,left:-300});
	setTimeout( function(){ USERS_MISC_FUNCTIONS.initialize_formFields(); }, 10 );
};

var USERS_MISC_FUNCTIONS = {
	initialize_formFields : function(){ // USERS_MISC_FUNCTIONS.initialize_formFields();
		//Load dialplans into 'edit_user_dialplan'
		var dps = parent.astgui_manageCallPlans.listPlans() ;
		dps.each(function(plan){
			var t = plan.withOut(ASTGUI.contexts.CallingPlanPrefix);
			ASTGUI.selectbox.append( 'edit_user_dialplan' , t, plan);
			ASTGUI.selectbox.append( 'edit_multiple_dialplan' , t, plan);
		});
		// Load Analog stations into 'edit_fxs'
		ASTGUI.selectbox.append( 'edit_fxs' ,'None', '');
		parent.sessionData.FXS_PORTS_DETECTED.each( function(item) { ASTGUI.selectbox.append( 'edit_fxs' , 'Port ' + item, item); } );

		(function(){
			var R = [];
			R.push( {optionText:'None', optionValue :'' });
			for ( var r in parent.sessionData.listOfCodecs ){
				R.push( {optionText: parent.sessionData.listOfCodecs[r] , optionValue : r });
			}
			ASTGUI.selectbox.populateArray('codec_one', R);
			ASTGUI.selectbox.populateArray('codec_two', R);
			ASTGUI.selectbox.populateArray('codec_three', R);
			ASTGUI.selectbox.populateArray('codec_fourth', R);
			ASTGUI.selectbox.populateArray('codec_fifth', R);
			ASTGUI.selectbox.populateArray('edit_multiple_codec_one', R);
			ASTGUI.selectbox.populateArray('edit_multiple_codec_two', R);
			ASTGUI.selectbox.populateArray('edit_multiple_codec_three', R);
			ASTGUI.selectbox.populateArray('edit_multiple_codec_fourth', R);
			ASTGUI.selectbox.populateArray('edit_multiple_codec_fifth', R);
		})();

		ASTGUI.selectbox.populateOptions( 'edit_pickupgroup', 20 );
		ASTGUI.selectbox.populateOptions( 'edit_multiple_pickupgroup', 20 );

		ASTGUI.domActions.enableDisableByCheckBox( 'edit_hasSip' , ['edit_nat','edit_canreinvite','edit_dtmfmode','edit_insecure'] );

		ASTGUI.domActions.enableDisableByCheckBox( 'edit_check_multiple_obcid' , [ 'edit_multiple_obcid' ] );
		ASTGUI.domActions.enableDisableByCheckBox( 'edit_check_multiple_dialplan' , [ 'edit_multiple_dialplan' ] );
		ASTGUI.domActions.enableDisableByCheckBox( 'edit_check_multiple_hasvoicemail' , [ 'edit_multiple_hasvoicemail' ] );
		ASTGUI.domActions.enableDisableByCheckBox( 'edit_check_multiple_vmsecret' , [ 'edit_multiple_vmCHoice1', 'edit_multiple_vmCHoice2', 'edit_multiple_vmsecret'] );
		ASTGUI.domActions.enableDisableByCheckBox( 'edit_check_multiple_hassip' , [ 'edit_multiple_hassip' ] );
		ASTGUI.domActions.enableDisableByCheckBox( 'edit_check_multiple_hasiax' , [ 'edit_multiple_hasiax' ] );
		ASTGUI.domActions.enableDisableByCheckBox( 'edit_check_multiple_allow' , [ 'edit_multiple_codec_one', 'edit_multiple_codec_two', 'edit_multiple_codec_three' , 'edit_multiple_codec_fourth' , 'edit_multiple_codec_fifth'  ] );
		ASTGUI.domActions.enableDisableByCheckBox( 'edit_check_multiple_flashrxflash' , [ 'edit_multiple_flash', 'edit_multiple_rxflash'  ] );
		ASTGUI.domActions.enableDisableByCheckBox( 'edit_check_multiple_secret' , [ 'edit_multiple_seCHoice1', 'edit_multiple_seCHoice2', 'edit_multiple_secret'  ] );
		ASTGUI.domActions.enableDisableByCheckBox( 'edit_check_multiple_nat' , [ 'edit_multiple_nat' ] );
		ASTGUI.domActions.enableDisableByCheckBox( 'edit_check_multiple_canreinvite' , [ 'edit_multiple_canreinvite' ] );
		ASTGUI.domActions.enableDisableByCheckBox( 'edit_check_multiple_dtmfmode' , [ 'edit_multiple_dtmfmode' ] );
		ASTGUI.domActions.enableDisableByCheckBox( 'edit_check_multiple_insecure' , [ 'edit_multiple_insecure' ] );
		ASTGUI.domActions.enableDisableByCheckBox( 'edit_check_multiple_3waycalling' , [ 'edit_multiple_3waycalling' ] );
		ASTGUI.domActions.enableDisableByCheckBox( 'edit_check_multiple_indirectory' , [ 'edit_multiple_indirectory' ] );
		ASTGUI.domActions.enableDisableByCheckBox( 'edit_check_multiple_callwaiting' , [ 'edit_multiple_callwaiting' ] );
		ASTGUI.domActions.enableDisableByCheckBox( 'edit_check_multiple_cti' , [ 'edit_multiple_cti' ] );
		ASTGUI.domActions.enableDisableByCheckBox( 'edit_check_multiple_isagent' , [ 'edit_multiple_isagent' ] );
		ASTGUI.domActions.enableDisableByCheckBox( 'edit_check_multiple_pickupgroup' , [ 'edit_multiple_pickupgroup' ] );

		
	},

	load_users_table : function(){ // USERS_MISC_FUNCTIONS.load_users_table
		var TBL = _$('table_userslist') ;
		var addCell = ASTGUI.domActions.tr_addCell; // temporarily store the function
		var ul = parent.astgui_manageusers.listOfUsers();  ul = ul.sortNumbers( );
		if(!ul.length){
			ASTGUI.domActions.clear_table( TBL );
			var newRow = TBL.insertRow(-1);
			newRow.className = 'even';
			addCell( newRow , { html:'No users created !!'} );
			return ;
		}
		(function(){ // add first row
			var CA = document.createElement('input'); CA.type = 'checkbox' ; CA.id = 'CHECKALL' ;
			ASTGUI.events.add( CA , 'click' , function(){
				if( _$('CHECKALL').checked ) {
					ASTGUI.domActions.CheckAll('selected_extensions');
				}else{
					ASTGUI.domActions.unCheckAll('selected_extensions');
				}
			});

			var newRow = TBL.insertRow(-1);
			newRow.className = "frow";

			var newcell = newRow.insertCell( newRow.cells.length );
			newcell.width = '15px' ;
			newcell.appendChild( CA );

			addCell( newRow , { html:'Extension'} );
			addCell( newRow , { html:'Full Name'} );
			addCell( newRow , { html:'Port'} );
			addCell( newRow , { html:'SIP'} );
			addCell( newRow , { html:'IAX'} );
			addCell( newRow , { html:'DialPlan', onclickFunction: function(){ parent.miscFunctions.click_panel('dialplans.html'); } } );
			addCell( newRow , { html:'OutBound CID'} );
			addCell( newRow , { html:''} );
		})();
	
		ul.each(function(user){ // list each user in table
			var tmp = [] ;
			tmp[0] = "<span class='guiButton' onclick=\"USERS_MISC_FUNCTIONS.EDIT_USER_FORM('" + user +"')\">Edit</span>&nbsp;"
				+ "<span class='guiButtonDelete' onclick=\"USERS_MISC_FUNCTIONS.DELETE_USER('" + user +"')\">Delete</span>" ;
			tmp[1] = parent.sessionData.pbxinfo.GLOBALS[ASTGUI.globals.obcidUsrPrefix + user] || '<span class=\'no_obcid\'>none</span>' ;

			var ud = parent.sessionData.pbxinfo.users[user]; // temporarily store all details of this user
			var newRow = TBL.insertRow(-1); //newRow.className = "frow";
			newRow.className = ((TBL.rows.length)%2==1)?'odd':'even';
			addCell( newRow , { html: "<input type=checkbox  class='selected_extensions' value='"+ user +"'>" } );
			addCell( newRow , { html: user } );
			addCell( newRow , { html: ud.getProperty('fullname') || '--' } );
			addCell( newRow , { html: ud.getProperty('zapchan') || '--' } );
			addCell( newRow , { html: ( ud.getProperty('hassip').isAstTrue() ) ? 'Yes' : '--' , align:'center'} );
			addCell( newRow , { html: ( ud.getProperty('hasiax').isAstTrue() ) ? 'Yes' : '--' , align:'center'} );

			var tmp_this_dp = ud.getProperty('context').withOut(ASTGUI.contexts.CallingPlanPrefix) ;
			if( !tmp_this_dp || !parent.sessionData.pbxinfo.callingPlans[ud.getProperty('context')] ){
				addCell( newRow , { html: '<font color=red>No DialPlan assigned</font>'});
			}else{
				addCell( newRow , { html: tmp_this_dp } );
			}

			addCell( newRow , { html:tmp[1], align:'center'} );
			addCell( newRow , { html:tmp[0], align:'center'} );
		});
	},

	RESET_USER_FORM_FIELDS: function(){ // USERS_MISC_FUNCTIONS.RESET_USER_FORM_FIELDS();
		ASTGUI.resetTheseFields( ['new_ext','edit_fullname','edit_user_dialplan','edit_callerid','edit_OutBoundCallerid','edit_hasvoicemail','edit_vmsecret','edit_email','edit_hasSip','edit_hasIax','edit_fxs','edit_flash','edit_rxflash','codec_one','codec_two','codec_three','codec_fourth','codec_fifth','macaddress','linenumber','edit_secret','edit_nat','edit_canreinvite','edit_dtmfmode','edit_insecure','edit_3wayCalling','edit_inDirectory','edit_callWaiting','edit_cti','edit_isagent','edit_pickupgroup'] );
		_$('edit_fxs').selectedIndex = 0; _$('codec_one').selectedIndex = 0; _$('codec_two').selectedIndex = 0; _$('codec_three').selectedIndex = 0; _$('codec_fourth').selectedIndex = 0; 
		_$('codec_fifth').selectedIndex = 0; _$('linenumber').selectedIndex = 0; _$('edit_pickupgroup').selectedIndex = 0;

		ASTGUI.updateFieldToValue( 'edit_user_dialplan', parent.sessionData.GUI_PREFERENCES.getProperty('default_dialplan') );

		if( isNewUSER == false){
			_$('new_ext').disabled = true;
			var uinfo = parent.sessionData.pbxinfo.users[EXTENSION_EDIT];

			if( uinfo.getProperty('mailbox').contains('MailboxStore') ){
				$('#tmp_hideIfRmwi').hide();
			}else{
				$('#tmp_hideIfRmwi').show();
			}

			ASTGUI.updateFieldToValue( 'new_ext', EXTENSION_EDIT );
//			ASTGUI.updateFieldToValue( 'macaddress', uinfo.getProperty('macaddress') );
			ASTGUI.updateFieldToValue( 'edit_fullname', uinfo.getProperty('fullname') );
			ASTGUI.updateFieldToValue( 'edit_user_dialplan', uinfo.getProperty('context') );
			ASTGUI.updateFieldToValue( 'edit_callerid', uinfo.getProperty('cid_number') );
			ASTGUI.updateFieldToValue( 'edit_OutBoundCallerid', parent.astgui_manageusers.getOBCID_user(EXTENSION_EDIT) );
			ASTGUI.updateFieldToValue( 'edit_hasvoicemail', uinfo.getProperty('hasvoicemail') );
			ASTGUI.updateFieldToValue( 'edit_vmsecret', uinfo.getProperty('vmsecret') );
			ASTGUI.updateFieldToValue( 'edit_email', uinfo.getProperty('email') );
			ASTGUI.updateFieldToValue( 'edit_hasSip', uinfo.getProperty('hassip') );
			ASTGUI.updateFieldToValue( 'edit_hasIax', uinfo.getProperty('hasiax') );
			ASTGUI.updateFieldToValue( 'edit_fxs', uinfo.getProperty('zapchan') );
			ASTGUI.updateFieldToValue( 'edit_flash', uinfo.getProperty('flash') );
			ASTGUI.updateFieldToValue( 'edit_rxflash', uinfo.getProperty('rxflash') );
			// CODECS
			if( uinfo.getProperty('allow') == 'all'){
				ASTGUI.updateFieldToValue( 'codec_one', 'ulaw' );
				ASTGUI.updateFieldToValue( 'codec_two', 'alaw' );
				ASTGUI.updateFieldToValue( 'codec_three', 'gsm' );
				ASTGUI.updateFieldToValue( 'codec_fourth', 'g726' );
				ASTGUI.updateFieldToValue( 'codec_fifth', 'g722' );
			}else{
				var codecs_tmp = uinfo.getProperty('allow').split(',') ;
				ASTGUI.updateFieldToValue( 'codec_one', (codecs_tmp[0] && codecs_tmp[0].trim()) ||'' );
				ASTGUI.updateFieldToValue( 'codec_two', (codecs_tmp[1] && codecs_tmp[1].trim()) ||'' );
				ASTGUI.updateFieldToValue( 'codec_three', (codecs_tmp[2] && codecs_tmp[2].trim()) ||'' );
				ASTGUI.updateFieldToValue( 'codec_fourth', (codecs_tmp[3] && codecs_tmp[3].trim()) ||'' );
				ASTGUI.updateFieldToValue( 'codec_fifth', (codecs_tmp[4] && codecs_tmp[4].trim()) ||'' );
			}


			ASTGUI.updateFieldToValue( 'macaddress', uinfo.getProperty('macaddress') );
			ASTGUI.updateFieldToValue( 'linenumber', uinfo.getProperty('linenumber') );
			ASTGUI.updateFieldToValue( 'edit_secret', uinfo.getProperty('secret') );
			ASTGUI.updateFieldToValue( 'edit_nat', uinfo.getProperty('nat') );
			ASTGUI.updateFieldToValue( 'edit_canreinvite', uinfo.getProperty('canreinvite') );
			ASTGUI.updateFieldToValue( 'edit_dtmfmode', uinfo.getProperty('dtmfmode') );
			ASTGUI.updateFieldToValue( 'edit_insecure', uinfo.getProperty('insecure') );
			ASTGUI.updateFieldToValue( 'edit_3wayCalling', uinfo.getProperty('threewaycalling') );
			ASTGUI.updateFieldToValue( 'edit_inDirectory', uinfo.getProperty('hasdirectory') );
			ASTGUI.updateFieldToValue( 'edit_callWaiting', uinfo.getProperty('callwaiting') );
			ASTGUI.updateFieldToValue( 'edit_cti', uinfo.getProperty('hasmanager') );
			ASTGUI.updateFieldToValue( 'edit_isagent', uinfo.getProperty('hasagent') );
			ASTGUI.updateFieldToValue( 'edit_pickupgroup', uinfo.getProperty('pickupgroup') );
			zapchan_Before = uinfo.getProperty('zapchan');
		}else{
			_$('new_ext').disabled = false;
			ASTGUI.updateFieldToValue( 'codec_one', 'ulaw' );
			ASTGUI.updateFieldToValue( 'codec_two', 'gsm' );
			ASTGUI.updateFieldToValue( 'edit_hasSip', 'yes' );
			ASTGUI.updateFieldToValue( 'edit_hasIax', 'yes' );
			ASTGUI.updateFieldToValue( 'edit_flash', '750' );
			ASTGUI.updateFieldToValue( 'edit_rxflash', '1250' );
			var ul = parent.astgui_manageusers.listOfUsers();
			var tmp_newEXT = ul.firstAvailable( parent.sessionData.GUI_PREFERENCES.getProperty('ue_start') );
			ASTGUI.updateFieldToValue( 'new_ext', tmp_newEXT );
			ASTGUI.updateFieldToValue( 'edit_callerid', tmp_newEXT );
		}

		_$('edit_hasSip').updateStatus();
	},

	NEW_USER_FORM : function(){ // USERS_MISC_FUNCTIONS.NEW_USER_FORM();
		var dps = parent.astgui_manageCallPlans.listPlans() ;
		if(!dps.length){
			ASTGUI.yesOrNo (
				{	msg: "No DialPlans defined !! <BR><BR> A dialplan is required for creating new users. <BR> You will now be redirected to the 'Manage DialPlans' page.",
					ifyes: function(){ parent.miscFunctions.click_panel('dialplans.html'); } ,
					ifno: function(){ } ,
					btnYes_text :'&nbsp;&nbsp;Ok&nbsp;&nbsp;',
					title: 'No DialPlans found !!',
					hideNo: true
				}
			);
			return;
		}

		isNewUSER = true;
		EXTENSION_EDIT = '';
		zapchan_Before = '';
		_$('edit_userExtension_div_title').innerHTML = 'Create New User';
		ASTGUI.feedback( { msg: 'Create New User !', showfor: 2 , color: 'green', bgcolor: '#FFFFFF' } );
		USERS_MISC_FUNCTIONS.RESET_USER_FORM_FIELDS();
		$('#edit_userExtension_div').showWithBg();
	},

	EDIT_USER_FORM : function(a){ // USERS_MISC_FUNCTIONS.EDIT_USER_FORM();
		isNewUSER = false ;
		EXTENSION_EDIT = a ;
		ASTGUI.feedback( { msg: 'Edit User Extension !', showfor: 2 , color: 'green', bgcolor: '#FFFFFF' } );
		_$('edit_userExtension_div_title').innerHTML = 'Edit User Extension - ' + a ;
		USERS_MISC_FUNCTIONS.RESET_USER_FORM_FIELDS();
		$('#edit_userExtension_div').showWithBg();
	},
	
	getSelectedUsers : function(){ // USERS_MISC_FUNCTIONS.getSelectedUsers();
		return ASTGUI.domActions.get_checked('selected_extensions') ; 
	},

	EDIT_SELECTEDUSERs_FORM : function(){ // USERS_MISC_FUNCTIONS.EDIT_SELECTEDUSERs_FORM();
		var sel_users = USERS_MISC_FUNCTIONS.getSelectedUsers();
		if(!sel_users.length){
			ASTGUI.feedback( { msg: ' Please select one or more users to modify !', showfor: 4 });
			return;
		}
		ASTGUI.resetTheseFields( MULTI_FIELDS );
		MULTI_FIELDS.each( function(this_field_str){
			try{
				_$(this_field_str).updateStatus();
			}catch(err){

			}
		});

		_$('edit_multiple_codec_one').selectedIndex = 0
		_$('edit_multiple_codec_two').selectedIndex = 0
		_$('edit_multiple_codec_three').selectedIndex = 0
		_$('edit_multiple_codec_fourth').selectedIndex = 0
		_$('edit_multiple_codec_fifth').selectedIndex = 0
		$('#edit_selectedExtensions_div').showWithBg();
	},

	DELETE_USER : function(a){ // USERS_MISC_FUNCTIONS.DELETE_USER();
		var reload_page = function(){
			ASTGUI.feedback( { msg:'Deleted User - ' + a , showfor:2,  color:'#a02920' } );
			parent.ASTGUI.dialog.hide();
			window.location.reload();
		};
		if (!confirm('Are you sure you want to delete the selected user - ' + a + ' ?')) { return; }
		var yn = confirm("Delete user's voicemail box too ?" );
		parent.ASTGUI.dialog.waitWhile(' deleting user ' + a );
		parent.astgui_manageusers.deleteuser(a , yn , reload_page );
	},

	DELETE_SELECTED_USERS : function(){ // USERS_MISC_FUNCTIONS.DELETE_SELECTED_USERS();
		var sel_users = USERS_MISC_FUNCTIONS.getSelectedUsers();
		if(!sel_users.length){
			ASTGUI.feedback( { msg: ' Please select one or more users to delete !', showfor: 4 });
			return;
		}
		if( !confirm('Are you sure you want to delete the selected users - ' + sel_users.join(',') + ' ?') ) { return; }

		var after_deletingFirstUser = function(){
			sel_users.removeFirst();
			if(!sel_users.length ){
				ASTGUI.feedback( { msg:'Deleted selected Users !!', showfor:2,  color:'#a02920' } );
				parent.ASTGUI.dialog.hide();
				window.location.reload();
			}else{
				delete_firstUser();
			}
		};

		var delete_firstUser = function(){
			var yn = confirm("Delete voicemail box for user " + sel_users[0] + " ?" );
			parent.ASTGUI.dialog.waitWhile(' deleting user ' + sel_users[0] );
			parent.astgui_manageusers.deleteuser(sel_users[0] , yn , after_deletingFirstUser );
		};

		parent.ASTGUI.dialog.waitWhile(' Deleting selected users .... ');
		delete_firstUser();
	},

	check_duplicate_lineNumber : function(){ // USERS_MISC_FUNCTIONS.check_duplicate_lineNumber()  check if another user has the same mac address and line number
		var ul = parent.astgui_manageusers.listOfUsers();
		for( var f=0 ; f < ul.length ; f++ ){
			var uinfo = parent.sessionData.pbxinfo.users[ ul[f] ];
			if( !isNewUSER && EXTENSION_EDIT == ul[f] ){
				continue;
			}
			var ma = ASTGUI.getFieldValue('macaddress');
			var ln = ASTGUI.getFieldValue('linenumber');
			if( ma && ma == uinfo.getProperty('macaddress') && ln == uinfo.getProperty('linenumber') ){
				return false;
			}
		}
		return true;
	},

	SAVE_USER_FORM : function(){ // USERS_MISC_FUNCTIONS.SAVE_USER_FORM();
		if ( !ASTGUI.checkRequiredFields(['new_ext']) ) return ;
		if ( !ASTGUI.validateFields(['new_ext'] ) ) return ;

		if ( !ASTGUI.getFieldValue('edit_hasSip').isAstTrue() && ASTGUI.getFieldValue('edit_fxs') && !ASTGUI.getFieldValue('macaddress') ){
			ASTGUI.updateFieldToValue( 'macaddress',  ASTGUI.getFieldValue('new_ext') );
		}else if( ASTGUI.getFieldValue('edit_hasSip').isAstTrue() ){
			if ( !ASTGUI.validateFields(['macaddress'])) return ;
		}

		if( ! USERS_MISC_FUNCTIONS.check_duplicate_lineNumber() ){
			ASTGUI.highlightField('linenumber', "duplicate 'Line Number'");
			return;
		}
		var tmp = ASTGUI.getFieldValue('edit_OutBoundCallerid') ;
		if( tmp && tmp.length < 3 ){
			ASTGUI.highlightField('edit_OutBoundCallerid', "OutBound CallerId should be atleast 2 digits");
			return;
		}
		if( tmp && tmp.length > 19  ){
			ASTGUI.highlightField('edit_OutBoundCallerid', "Too many digits in OutBound CallerId");
			return;
		}
		tmp = '';
		if( !_$('edit_hasSip').checked && !_$('edit_hasIax').checked && !_$('edit_fxs').value ){
			ASTGUI.feedback( { msg:'You need to choose a technology or assign an analog station for this user extension.' , showfor: 3, color: 'red' } );
			return;
		}

		if( (ASTGUI.getFieldValue('edit_hasSip').isAstTrue() ||  ASTGUI.getFieldValue('edit_hasIax').isAstTrue() ) && !ASTGUI.getFieldValue('codec_one') && !ASTGUI.getFieldValue('codec_two') && !ASTGUI.getFieldValue('codec_three') && !ASTGUI.getFieldValue('codec_fourth') && !ASTGUI.getFieldValue('codec_fifth') ){
			ASTGUI.feedback( { msg:'You need to choose at least one codec !' , showfor: 5, color: 'red' } );
			return;
		}

		if( isNewUSER  ){

				var NU_EXT = ASTGUI.getFieldValue('new_ext');
				if( ! ASTGUI.miscFunctions.isExtensionInRange( NU_EXT ,'ue_start','ue_end') ){
					ASTGUI.highlightField('new_ext' , 'Extension is not in preferred range');
					parent.ASTGUI.dialog.hide();
					return;
				}
				if( parent.miscFunctions.ifExtensionAlreadyExists(NU_EXT) ){
					ASTGUI.highlightField('new_ext', 'Extension already exists');
					parent.ASTGUI.dialog.hide();
					return;
				}
				var cb = function(){
					// Now we will call this function again , to update the rest of the User Properties
					EXTENSION_EDIT = NU_EXT ;
					isNewUSER = false ;
					setTimeout( function(){  USERS_MISC_FUNCTIONS.SAVE_USER_FORM();  } , 500 );
				};
				var newuser_settings = ASTGUI.toCustomObject( { fullname : ASTGUI.getFieldValue('edit_fullname'), registersip: 'no', host: 'dynamic', callgroup : '1' } );
				parent.ASTGUI.dialog.waitWhile(' Saving... ');
				parent.astgui_manageusers.addUser( NU_EXT, newuser_settings , cb );
				return;
		}else{
			///////////////////
			parent.ASTGUI.dialog.waitWhile(' Saving... ');
			var u = EXTENSION_EDIT;
			var tmp_obj = {};
			var x = new listOfActions();
			x.filename('users.conf');
			x.new_action('update', u, 'fullname', 		ASTGUI.getFieldValue('edit_fullname') );	tmp_obj['fullname'] = ASTGUI.getFieldValue('edit_fullname') ;
			x.new_action('update', u, 'context', 		ASTGUI.getFieldValue('edit_user_dialplan') );	tmp_obj['context'] = ASTGUI.getFieldValue('edit_user_dialplan') ;
			x.new_action('update', u, 'cid_number', 	ASTGUI.getFieldValue('edit_callerid') );	tmp_obj['cid_number'] = ASTGUI.getFieldValue('edit_callerid') ;
			x.new_action('update', u, 'hasvoicemail',	ASTGUI.getFieldValue('edit_hasvoicemail') );	tmp_obj['hasvoicemail'] = ASTGUI.getFieldValue('edit_hasvoicemail') ;
			x.new_action('update', u, 'vmsecret', 		ASTGUI.getFieldValue('edit_vmsecret') );	tmp_obj['vmsecret'] = ASTGUI.getFieldValue('edit_vmsecret') ;
			x.new_action('update', u, 'email', 		ASTGUI.getFieldValue('edit_email') );		tmp_obj['email'] = ASTGUI.getFieldValue('edit_email') ;
			x.new_action('update', u, 'threewaycalling',	ASTGUI.getFieldValue('edit_3wayCalling') );	tmp_obj['threewaycalling'] = ASTGUI.getFieldValue('edit_3wayCalling') ;
			x.new_action('update', u, 'hasdirectory', 	ASTGUI.getFieldValue('edit_inDirectory') );	tmp_obj['hasdirectory'] = ASTGUI.getFieldValue('edit_inDirectory') ;
			x.new_action('update', u, 'callwaiting', 	ASTGUI.getFieldValue('edit_callWaiting') );	tmp_obj['callwaiting'] = ASTGUI.getFieldValue('edit_callWaiting') ;
			x.new_action('update', u, 'hasmanager', 	ASTGUI.getFieldValue('edit_cti') );		tmp_obj['hasmanager'] = ASTGUI.getFieldValue('edit_cti') ;
			if( ASTGUI.getFieldValue('edit_cti') == 'yes' ){
				var tmp_permisions = 'system,call,log,verbose,command,agent,user,config' ;
				x.new_action('update', u, 'managerread', tmp_permisions); 				tmp_obj['managerread'] = tmp_permisions ;
				x.new_action('update', u, 'managerwrite', tmp_permisions);				tmp_obj['managerwrite'] = tmp_permisions ;
			}else{
				x.new_action('delete', u, 'managerread', '' , '' );					tmp_obj['managerread'] = '';
				x.new_action('delete', u, 'managerwrite', '' , '' );					tmp_obj['managerwrite'] = '';
			}
			x.new_action('update', u, 'hasagent', 		ASTGUI.getFieldValue('edit_isagent') );		tmp_obj['hasagent'] = ASTGUI.getFieldValue('edit_isagent') ;
			x.new_action('update', u, 'hassip', 		ASTGUI.getFieldValue('edit_hasSip') );		tmp_obj['hassip'] = ASTGUI.getFieldValue('edit_hasSip') ;
			x.new_action('update', u, 'hasiax', 		ASTGUI.getFieldValue('edit_hasIax') );		tmp_obj['hasiax'] = ASTGUI.getFieldValue('edit_hasIax') ;
			x.new_action('update', u, 'secret', 		ASTGUI.getFieldValue('edit_secret') );		tmp_obj['secret'] = ASTGUI.getFieldValue('edit_secret') ;
			x.new_action('update', u, 'nat', 		ASTGUI.getFieldValue('edit_nat') );		tmp_obj['nat'] = ASTGUI.getFieldValue('edit_nat') ;
			x.new_action('update', u, 'canreinvite', 	ASTGUI.getFieldValue('edit_canreinvite') );	tmp_obj['canreinvite'] = ASTGUI.getFieldValue('edit_canreinvite') ;
			x.new_action('update', u, 'dtmfmode', 		ASTGUI.getFieldValue('edit_dtmfmode') );	tmp_obj['dtmfmode'] = ASTGUI.getFieldValue('edit_dtmfmode') ;
			x.new_action('update', u, 'insecure', 		ASTGUI.getFieldValue('edit_insecure') );	tmp_obj['insecure'] = ASTGUI.getFieldValue('edit_insecure') ;
			x.new_action('update', u, 'pickupgroup', 	ASTGUI.getFieldValue('edit_pickupgroup') );	tmp_obj['pickupgroup'] = ASTGUI.getFieldValue('edit_pickupgroup') ;

			var tmp_cl = parent.sessionData.pbxinfo.users[u].getProperty('call-limit') ;
			if( !tmp_cl ){
				x.new_action('update', u, 'call-limit', '100' );
				tmp_obj['call-limit'] = '100' ;
			}

			if( zapchan_Before != ASTGUI.getFieldValue('edit_fxs') ){ 	ASTGUI.cookies.setCookie( 'require_restart' , 'yes' );	}
			(function(){
				var fs = ASTGUI.getFieldValue('edit_fxs');
				if(fs){
					var tmp_flash = ASTGUI.getFieldValue('edit_flash') || '750';
					var tmp_rxflash = ASTGUI.getFieldValue('edit_rxflash') || '1250';
					var sg = (parent.sessionData.PORTS_SIGNALLING.ls.contains(fs)) ? 'fxo_ls':'fxo_ks' ;

					x.new_action('update', u, 'signalling', sg) ;					tmp_obj['signalling'] = sg ;
					x.new_action('update', u, 'flash',  tmp_flash) ;				tmp_obj['flash'] = tmp_flash ;
					x.new_action('update', u, 'rxflash', tmp_rxflash ) ;				tmp_obj['rxflash'] = tmp_rxflash ;
					x.new_action('delete', u, 'zapchan', '') ;
					x.new_action('append', u, 'zapchan', fs );					tmp_obj['zapchan'] = fs ;
				}else{
					x.new_action('delete', u, 'zapchan', '') ;					tmp_obj['zapchan'] = '' ;
				}

				var codecs = '';
				if( ASTGUI.getFieldValue('codec_one') ){ codecs = codecs + ASTGUI.getFieldValue('codec_one') }
				if( ASTGUI.getFieldValue('codec_two') ){ codecs = codecs + ',' + ASTGUI.getFieldValue('codec_two') }
				if( ASTGUI.getFieldValue('codec_three') ){ codecs = codecs + ',' + ASTGUI.getFieldValue('codec_three') }
				if( ASTGUI.getFieldValue('codec_fourth') ){ codecs = codecs + ',' + ASTGUI.getFieldValue('codec_fourth') }
				if( ASTGUI.getFieldValue('codec_fifth') ){ codecs = codecs + ',' + ASTGUI.getFieldValue('codec_fifth') }
				x.new_action('delete', u, 'disallow', '') ;
				x.new_action('delete', u, 'allow', '') ;
				x.new_action('append', u, 'disallow', 'all') ;					tmp_obj['disallow'] = 'all' ;
				if(!codecs){
					x.new_action('append', u, 'allow', 'all' ) ;					tmp_obj['allow'] = 'all' ;
				}else{
					x.new_action('append', u, 'allow', codecs ) ;					tmp_obj['allow'] = codecs ;
				}
			})();
			if( _$('macaddress').value ){
				x.new_action('update', u, 'macaddress', ASTGUI.getFieldValue('macaddress') );		tmp_obj['macaddress'] = ASTGUI.getFieldValue('macaddress');
				x.new_action('update', u, 'autoprov', 'yes');						tmp_obj['autoprov'] = 'yes';
				x.new_action('update', u, 'label', u );							tmp_obj['label'] = u;
				x.new_action('update', u, 'linenumber', ASTGUI.getFieldValue('linenumber') );		tmp_obj['linenumber'] = ASTGUI.getFieldValue('linenumber');
			}else{
				x.new_action('update', u, 'autoprov', 'no');						tmp_obj['autoprov'] = 'no';
				x.new_action('update', u, 'label', '' );						tmp_obj['label'] = '';
				x.new_action('update', u, 'macaddress', ASTGUI.getFieldValue('macaddress') );		tmp_obj['macaddress'] = ASTGUI.getFieldValue('macaddress');
				x.new_action('update', u, 'linenumber', ASTGUI.getFieldValue('linenumber') );		tmp_obj['linenumber'] = ASTGUI.getFieldValue('linenumber');
			}
			var after = function(){
				parent.sessionData.pbxinfo.users[u].updateProperties(tmp_obj); // update all the edited values
				var v = ASTGUI.globals.obcidUsrPrefix + u;
				var w = ASTGUI.getFieldValue('edit_OutBoundCallerid') ;
				if( w ){
					if( ASTGUI.updateaValue({ file: 'extensions.conf', context: 'globals', variable: v , value:w }) ){
						try{ parent.sessionData.pbxinfo['GLOBALS'][v] = w; } catch(err){ }
					}
				}else{
					var mm = new listOfSynActions('extensions.conf') ;
					mm.new_action('delete', 'globals', v , '');
					mm.callActions();
					try{ delete parent.sessionData.pbxinfo['GLOBALS'][v] } catch(err){ }
				}
				parent.ASTGUI.dialog.hide();
				ASTGUI.feedback( { msg:'Updated !', showfor:2, color:'green' } );
				window.location.reload();
			};
		
			x.callActions(after);
			///////////////////
		}

	// END OF USERS_MISC_FUNCTIONS.SAVE_USER_FORM();
	},
	
	save_multiple_users : function(){ // USERS_MISC_FUNCTIONS.save_multiple_users()
		var users = ASTGUI.domActions.get_checked('selected_extensions') ;
		var x = new listOfActions('users.conf');
		var merge_list = {};
		var OBCID_LIST = {};

		users.each( function( u ) {
			///// ***************** /////
			var tmp_obj = {};
 			//'edit_check_multiple_obcid' , 'edit_multiple_obcid' ,  
			if ( _$('edit_check_multiple_obcid').checked  ){
				OBCID_LIST[ASTGUI.globals.obcidUsrPrefix + u] = ASTGUI.getFieldValue('edit_multiple_obcid') ;
			}

			if( _$('edit_check_multiple_dialplan').checked ){
				x.new_action('update', u , 'context',  ASTGUI.getFieldValue('edit_multiple_dialplan') );
				tmp_obj['context'] = ASTGUI.getFieldValue('edit_multiple_dialplan') ;
			}
			if( _$('edit_check_multiple_hasvoicemail').checked ){
				x.new_action('update', u, 'hasvoicemail',  ASTGUI.getFieldValue('edit_multiple_hasvoicemail') );
				tmp_obj['hasvoicemail'] = ASTGUI.getFieldValue('edit_multiple_hasvoicemail') ;
			}
			if( _$('edit_check_multiple_vmsecret').checked ){
				x.new_action('update', u, 'vmsecret',  ASTGUI.getFieldValue('edit_multiple_vmsecret') );
				tmp_obj['vmsecret'] = ASTGUI.getFieldValue('edit_multiple_vmsecret') ;
			}
			if( _$('edit_check_multiple_hassip').checked ){
				x.new_action('update', u, 'hassip',  ASTGUI.getFieldValue('edit_multiple_hassip') );
				tmp_obj['hassip'] = ASTGUI.getFieldValue('edit_multiple_hassip') ;
			}
			if( _$('edit_check_multiple_hasiax').checked ){
				x.new_action('update', u, 'hasiax',  ASTGUI.getFieldValue('edit_multiple_hasiax') );
				tmp_obj['hasiax'] = ASTGUI.getFieldValue('edit_multiple_hasiax') ;
			}
			if( _$('edit_check_multiple_allow').checked ){
				var codecs = '';
				if( ASTGUI.getFieldValue('edit_multiple_codec_one') ){ codecs = codecs + ASTGUI.getFieldValue('edit_multiple_codec_one') }
				if( ASTGUI.getFieldValue('edit_multiple_codec_two') ){ codecs = codecs + ',' + ASTGUI.getFieldValue('edit_multiple_codec_two') }
				if( ASTGUI.getFieldValue('edit_multiple_codec_three') ){ codecs = codecs + ',' + ASTGUI.getFieldValue('edit_multiple_codec_three') }
				if( ASTGUI.getFieldValue('edit_multiple_codec_fourth') ){ codecs = codecs + ',' + ASTGUI.getFieldValue('edit_multiple_codec_fourth') }
				if( ASTGUI.getFieldValue('edit_multiple_codec_fifth') ){ codecs = codecs + ',' + ASTGUI.getFieldValue('edit_multiple_codec_fifth') }
				x.new_action('update', u, 'allow',  codecs);
				tmp_obj['allow'] = codecs ;
			}
			if( _$('edit_check_multiple_flashrxflash').checked ){
				x.new_action('update', u, 'flash',  ASTGUI.getFieldValue('edit_multiple_flash') );
				tmp_obj['flash'] = ASTGUI.getFieldValue('edit_multiple_flash') ;
				x.new_action('update', u, 'rxflash',  ASTGUI.getFieldValue('edit_multiple_rxflash') );
				tmp_obj['rxflash'] = ASTGUI.getFieldValue('edit_multiple_rxflash') ;
			}
			if( _$('edit_check_multiple_secret').checked ){
				x.new_action('update', u, 'secret',  ASTGUI.getFieldValue('edit_multiple_secret') );
				tmp_obj['secret'] = ASTGUI.getFieldValue('edit_multiple_secret') ;
			}
			if( _$('edit_check_multiple_nat').checked ){
				x.new_action('update', u, 'nat',  ASTGUI.getFieldValue('edit_multiple_nat') );
				tmp_obj['nat'] = ASTGUI.getFieldValue('edit_multiple_nat') ;
			}
			if( _$('edit_check_multiple_canreinvite').checked ){
				x.new_action('update', u, 'canreinvite',  ASTGUI.getFieldValue('edit_multiple_canreinvite') );
				tmp_obj['canreinvite'] = ASTGUI.getFieldValue('edit_multiple_canreinvite') ;
			}
			if( _$('edit_check_multiple_dtmfmode').checked ){
				x.new_action('update', u, 'dtmfmode',  ASTGUI.getFieldValue('edit_multiple_dtmfmode') );
				tmp_obj['dtmfmode'] = ASTGUI.getFieldValue('edit_multiple_dtmfmode') ;
			}
			if( _$('edit_check_multiple_insecure').checked ){
				x.new_action('update', u, 'insecure',  ASTGUI.getFieldValue('edit_multiple_insecure') );
				tmp_obj['insecure'] = ASTGUI.getFieldValue('edit_multiple_insecure') ;
			}
			if( _$('edit_check_multiple_3waycalling').checked ){
				x.new_action('update', u, 'threewaycalling',  ASTGUI.getFieldValue('edit_multiple_3waycalling') );
				tmp_obj['threewaycalling'] = ASTGUI.getFieldValue('edit_multiple_3waycalling') ;
			}
			if( _$('edit_check_multiple_indirectory').checked ){
				x.new_action('update', u, 'hasdirectory',  ASTGUI.getFieldValue('edit_multiple_indirectory') );
				tmp_obj['hasdirectory'] = ASTGUI.getFieldValue('edit_multiple_indirectory') ;
			}
			if( _$('edit_check_multiple_callwaiting').checked ){
				x.new_action('update', u, 'callwaiting',  ASTGUI.getFieldValue('edit_multiple_callwaiting') );
				tmp_obj['callwaiting'] = ASTGUI.getFieldValue('edit_multiple_callwaiting') ;
			}
			if( _$('edit_check_multiple_cti').checked ){
				x.new_action('update', u, 'hasmanager',  ASTGUI.getFieldValue('edit_multiple_cti') );
				tmp_obj['hasmanager'] = ASTGUI.getFieldValue('edit_multiple_cti') ;
			}
			if( _$('edit_check_multiple_isagent').checked ){
				x.new_action('update', u, 'hasagent',  ASTGUI.getFieldValue('edit_multiple_isagent') );
				tmp_obj['hasagent'] = ASTGUI.getFieldValue('edit_multiple_isagent') ;
			}
			if( _$('edit_check_multiple_pickupgroup').checked ){
				x.new_action('update', u, 'pickupgroup',  ASTGUI.getFieldValue('edit_multiple_pickupgroup') );
				tmp_obj['pickupgroup'] = ASTGUI.getFieldValue('edit_multiple_pickupgroup') ;
			}
			merge_list[u] = tmp_obj ;
			///// ***************** /////
		});
		
		var after = function(){
			for (var f in merge_list){ if( merge_list.hasOwnProperty(f) ){
				parent.sessionData.pbxinfo.users[f].updateProperties( merge_list[f] );
			}}

			for ( var v in OBCID_LIST ){ if( OBCID_LIST.hasOwnProperty(v) ) {
				if( ASTGUI.updateaValue( { file: 'extensions.conf', context: 'globals', variable: v , value: OBCID_LIST[v] } ) ){
					try{ parent.sessionData.pbxinfo['GLOBALS'][v] = OBCID_LIST[v] ;} catch(err){ }
				}
			} }

			parent.ASTGUI.dialog.hide();
			ASTGUI.feedback( { msg:'Updated !' , showfor: 2 , color: 'green' } );
			window.location.reload();
		};
		x.callActions( after );
	}
};


var buynow_action = function(){
	win=window.open('','myWin');
	document.buynow_form.target='myWin';
	document.buynow_form.submit();
};

</script>
<body bgcolor="#EFEFEF">
<div class="iframeTitleBar"> User Extensions on PBX 
	<span class='refresh_icon' onclick="window.location.reload();" >&nbsp;<img src="images/refresh.png" title=" Refresh " border=0 >&nbsp;</span>
</div>
	<div class='top_buttons'>
		<span id='new' class='guiButtonNew' onclick='USERS_MISC_FUNCTIONS.NEW_USER_FORM();' style='float:left'>Create New User</span>
		<span class='guiButton' onclick='USERS_MISC_FUNCTIONS.EDIT_SELECTEDUSERs_FORM();' style='float:left'>Modify Selected Users</span>
		<span class='guiButtonDelete' onclick='USERS_MISC_FUNCTIONS.DELETE_SELECTED_USERS();' style='float:left'>Delete Selected Users</span>

		<span class='guiButton' style='float:right; margin-right:30px;' onclick='buynow_action();' id='whereToBuy_button' tip="en,users,98">Where to Buy</span>
		<span class='lite_Heading' style='margin-left: 80px'> List of User Extensions </span>
	</div>

<table id='table_userslist' cellpadding=0 cellspacing=0 border=0 align=center style='clear:both;'></table>

<div id="edit_userExtension_div" STYLE="width:750; display: none;" class='dialog'>
	<TABLE width="100%" cellpadding=0 cellspacing=0>
	<TR class="dialog_title_tr">
		<TD class="dialog_title" onmousedown="ASTGUI.startDrag(event);"><span id="edit_userExtension_div_title"></span></TD>
		<TD class="dialog_title_X" onclick="ASTGUI.hideDrag(event);"> X </TD>
	</TR>
	</TABLE>
	<TABLE	align=center cellpadding=2 cellspacing=4 border=0 width='100%'>
	<TR>	<TD>	<fieldset>
				<legend>&nbsp;General :&nbsp;</legend>
				<table>	<TR>
						<TD align="right">Extension:</TD>
						<TD>	<input id="new_ext" size=5  field_name='Extension' validation='numeric' required='yes'>
							<img src="images/tooltip_info.gif" tip="en,users,0" class='tooltipinfo'>
						</TD>
						<TD align="left">Name: <input id="edit_fullname" size=14>
							<img src="images/tooltip_info.gif" tip="en,users,1" class='tooltipinfo'>
						</TD>
						<TD align="right">DialPlan: <select id='edit_user_dialplan'></select>
							<img src="images/tooltip_info.gif" tip="en,users,6" class='tooltipinfo'>
						</TD>
					</TR>
					<TR>	<TD align='right'>CallerID:</TD>
						<TD>	<input id='edit_callerid' size=5>
							<img src="images/tooltip_info.gif" tip="en,users,4" class='tooltipinfo'>
						</TD>
						<TD align='left'>
							OutBound CallerID: <input id='edit_OutBoundCallerid' size=12>
							<img src="images/tooltip_info.gif" tip="en,users,27" class='tooltipinfo'>
						</TD>
						<TD align='left'></TD>
					</TR>
				</table>
			</fieldset>
		</TD>
	</TR>
	<TR id='tmp_hideIfRmwi'>
		<TD>
			<fieldset>
				<legend>&nbsp;<input type='checkbox' id='edit_hasvoicemail'>&nbsp;<label for='edit_hasvoicemail'>Enable Voicemail for this User <img src="images/tooltip_info.gif" tip="en,users,8" class='tooltipinfo'></label> </legend>
				<table>	<TR>	<TD>VoiceMail Access PIN code:</TD>
						<TD><input id="edit_vmsecret" size=4>
							<img src="images/tooltip_info.gif" tip="en,users,16" class='tooltipinfo'>
						</TD>
						<TD align="right"><span style="margin-left:30px;">Email Address:</span></TD>
						<TD><input id="edit_email" size=15>
							<img src="images/tooltip_info.gif" tip="en,users,3" class='tooltipinfo'>
						</TD>
					</TR>
				</table>
			</fieldset>
		</TD>
	</TR>

	<TR>	<TD>	<fieldset>
				<legend>&nbsp;Technology</legend>
				<TABLE> <TR>	<TD>

							<input type='checkbox' id='edit_hasSip'><label for='edit_hasSip'>SIP</label>
							<img src="images/tooltip_info.gif" tip="en,users,10" class='tooltipinfo'>
					
							<input type='checkbox' id='edit_hasIax'><label for='edit_hasIax'>IAX</label>
							<img src="images/tooltip_info.gif" tip="en,users,11" class='tooltipinfo'>

							Analog Station: <select id='edit_fxs'></select>
							<img src="images/tooltip_info.gif" tip="en,users,5" class='tooltipinfo'>


							flash <img src="images/tooltip_info.gif" tip="en,users,30" class='tooltipinfo'>:
								<input id='edit_flash' size=4>
							rxflash <img src="images/tooltip_info.gif" tip="en,users,31" class='tooltipinfo'>:
								<input id='edit_rxflash' size=4>
						</TD>
					</TR>
					<TR>	<TD>	Codec Preference : First :<select id='codec_one'></select>
									Second :<select id='codec_two'></select>
									Third :<select id='codec_three'></select>
									Fourth :<select id='codec_fourth'></select>
									Fifth :<select id='codec_fifth'></select>
						</TD>
					</TR>
				</TABLE>
			</fieldset>
		</TD>
	</TR>

	<TR>	<TD>	<fieldset>
				<legend>&nbsp;VoIP Settings</legend>
				<TABLE> <TR>	<TD>
							MAC Address : <input id='macaddress' size=12  field_name='MAC Address' validation='macaddress'>
							<img src="images/tooltip_info.gif" tip="en,users,99" class='tooltipinfo'>
							Line Number : <select id='linenumber'>
								<option value='1'>1</option>
								<option value='2'>2</option>
								<option value='3'>3</option>
								<option value='4'>4</option>
								<option value='5'>5</option>
								<option value='6'>6</option>
							</select>
							<img src="images/tooltip_info.gif" tip="en,users,96" class='tooltipinfo'>

							<span style="margin-left:40px;">SIP/IAX Password:</span>
							<input id="edit_secret" size=6>
							<img src="images/tooltip_info.gif" tip="en,users,2" class='tooltipinfo'>
						</TD>
					</TR>
					<TR>	<TD>
							NAT: <input type='checkbox' id='edit_nat' dfalt='yes'> <img src="images/tooltip_info.gif" tip="en,users,22" class='tooltipinfo'>
							Can Reinvite: <input type='checkbox' id='edit_canreinvite'> <img src="images/tooltip_info.gif" tip="en,users,21" class='tooltipinfo'>

							DTMF Mode: <select id="edit_dtmfmode" dfalt='rfc2833'><option value="rfc2833">RFC2833</option><option value="info" >Info</option><option value="inband" >Inband</option>
									<option value="auto" >Auto</option></select> <img src="images/tooltip_info.gif" tip="en,users,23" class='tooltipinfo'>
							
							insecure:  <select id="edit_insecure" dfalt='no' class="input8"><option value='port'>port</option><option value='port,invite'>very</option><option value='no'>no</option></select> <img src="images/tooltip_info.gif" tip="en,users,26" class='tooltipinfo'>
						</TD>
					</TR>
				</TABLE>
			</fieldset>
		</TD>
	</TR>


	<TR>	<TD>	<fieldset>
				<legend>&nbsp;Other Options</legend>
				<TABLE> <TR>	<TD>
						<input type='checkbox' id='edit_3wayCalling'>
						<label for='edit_3wayCalling'>3-Way Calling</label>
						<img src="images/tooltip_info.gif" tip="en,users,14" class='tooltipinfo'>

						<input type='checkbox' id='edit_inDirectory'>
						<label for='edit_inDirectory'>In Directory</label>
						<img src="images/tooltip_info.gif" tip="en,users,9" class='tooltipinfo'>

						<input type='checkbox' id='edit_callWaiting'>
						<label for='edit_callWaiting'>Call Waiting</label>
						<img src="images/tooltip_info.gif" tip="en,users,13" class='tooltipinfo'>

						<input type='checkbox' id='edit_cti'>
						<label for='edit_cti'>CTI</label>
						<img src="images/tooltip_info.gif" tip="en,users,12" class='tooltipinfo'>

						<input type='checkbox' id='edit_isagent'>
						<label for='edit_isagent'>Is Agent</label>
						<img src="images/tooltip_info.gif" tip="en,users,15" class='tooltipinfo'>

						Pickup Group: <select id='edit_pickupgroup'></select>

						</TD>
					</TR>
				</TABLE>
			</fieldset>
		</TD>
	</TR>

	<TR>	<TD align=center height=50 valign=middle>
			<span class='guiButtonCancel' onclick='ASTGUI.hideDrag(event);'>Cancel</span>
			<span class='guiButtonEdit' onclick='USERS_MISC_FUNCTIONS.SAVE_USER_FORM();'>Update</span>
		</TD>
	</TR>
	</TABLE>
</div>


<div id="edit_selectedExtensions_div" STYLE="width:600; display:none; " class='dialog'>
	<TABLE width="100%" cellpadding=0 cellspacing=0>
	<TR class="dialog_title_tr">
		<TD class="dialog_title" onmousedown="ASTGUI.startDrag(event);"> Modify Parameters on all selected users </TD>
		<TD class="dialog_title_X" onclick="ASTGUI.hideDrag(event);"> X </TD>
	</TR>
	</TABLE>
	<TABLE	align=center cellpadding=2 cellspacing=4 border=0 width='100%'>
		<TR>
			<TD></TD>
			<TD><strong>General</strong></TD>
		</TR>
		<TR>
			<TD><input type=checkbox id='edit_check_multiple_obcid'></TD>
			<TD> OutBound CallerID: <input id='edit_multiple_obcid' type=text size=12> <img src="images/tooltip_info.gif" tip="en,users,27" class='tooltipinfo'></TD>
		</TR>
		<TR>
			<TD><input type=checkbox id='edit_check_multiple_dialplan'></TD>
			<TD> DialPlan: <select id='edit_multiple_dialplan'></select>
				<img src="images/tooltip_info.gif" tip="en,users,6" class='tooltipinfo'>
			</TD>
		</TR>
		<TR>
			<TD><input type=checkbox id='edit_check_multiple_hasvoicemail'></TD>
			<TD>
				<input type=checkbox id='edit_multiple_hasvoicemail'> Enable Voicemail for these Users <img src="images/tooltip_info.gif" tip="en,users,8" class='tooltipinfo'>
			</TD>
		</TR>
		<TR>
			<TD><input type=checkbox id='edit_check_multiple_vmsecret'></TD>
			<TD>
				VoiceMail Access PIN code: <img src="images/tooltip_info.gif" tip="en,users,16" class='tooltipinfo'><BR>
						<input type=radio id='edit_multiple_vmCHoice1' name='edit_multiple_vmCHoice'> Use <input id='edit_multiple_vmsecret' size=4> for all users<BR>
						<input type=radio id='edit_multiple_vmCHoice2' name='edit_multiple_vmCHoice'> Use Extension as PIN	
			</TD>
		</TR>
		<TR>
			<TD></TD>
			<TD><strong>Technology</strong></TD>
		</TR>
		<TR>
			<TD><input type=checkbox id='edit_check_multiple_hassip'></TD>
			<TD>
				<input type=checkbox id='edit_multiple_hassip'> SIP <img src="images/tooltip_info.gif" tip="en,users,10" class='tooltipinfo'>
			</TD>
		</TR>
		<TR>
			<TD><input type=checkbox id='edit_check_multiple_hasiax'></TD>
			<TD>
				<input type=checkbox id='edit_multiple_hasiax'> IAX <img src="images/tooltip_info.gif" tip="en,users,11" class='tooltipinfo'>
			</TD>
		</TR>
		<TR>
			<TD></TD>
			<TD><strong>Codec Preference:</strong></TD>
		</TR>
		<TR>
			<TD><input type=checkbox id='edit_check_multiple_allow'></TD>
			<TD>
				First :<select id='edit_multiple_codec_one'></select>
				Second :<select id='edit_multiple_codec_two'></select>
				Third :<select id='edit_multiple_codec_three'></select>
				Fourth :<select id='edit_multiple_codec_fourth'></select>
				Fifth :<select id='edit_multiple_codec_fifth'></select>
			</TD>
		</TR>		
		<TR>
			<TD></TD>
			<TD><strong>Analog Settings:</strong></TD>
		</TR>
		<TR>
			<TD><input type=checkbox id='edit_check_multiple_flashrxflash'></TD>
			<TD>flash: <input id='edit_multiple_flash' size=4> <img src="images/tooltip_info.gif" tip="en,users,30" class='tooltipinfo'>
				rxflash: <input id='edit_multiple_rxflash' size=4> <img src="images/tooltip_info.gif" tip="en,users,31" class='tooltipinfo'>
			</TD>
		</TR>
		<TR>
			<TD></TD>
			<TD><strong>VoIP Settings:</strong></TD>
		</TR>
		<TR>
			<TD><input type=checkbox id='edit_check_multiple_secret'></TD>
			<TD>
			 	SIP/IAX Password: <img src="images/tooltip_info.gif" tip="en,users,2" class='tooltipinfo'>
				<BR>	<input type=radio id='edit_multiple_seCHoice1' name='edit_multiple_seCHoice'> Use <input id="edit_multiple_secret" size=4> for all users<BR>
						<input type=radio id='edit_multiple_seCHoice2' name='edit_multiple_seCHoice'> Use Extension as Password
			</TD>
		</TR>

		<TR>
			<TD><input type=checkbox id='edit_check_multiple_nat'></TD>
			<TD><input type='checkbox' id='edit_multiple_nat'> NAT <img src="images/tooltip_info.gif" tip="en,users,22" class='tooltipinfo'></TD>
		</TR>
		<TR>
			<TD><input type=checkbox id='edit_check_multiple_canreinvite'></TD>
			<TD><input type='checkbox' id='edit_multiple_canreinvite'> Can Reinvite <img src="images/tooltip_info.gif" tip="en,users,21" class='tooltipinfo'></TD>
		</TR>
		<TR>
			<TD><input type=checkbox id='edit_check_multiple_dtmfmode'></TD>
			<TD>
				DTMF Mode: <select id="edit_multiple_dtmfmode">
				<option value="rfc2833" >RFC2833</option>
				<option value="info" >Info</option>
				<option value="inband" >Inband</option>
				<option value="auto" >Auto</option>
				</select>
				<img src="images/tooltip_info.gif" tip="en,users,23" class='tooltipinfo'>
			</TD>
		</TR>
		<TR>
			<TD><input type=checkbox id='edit_check_multiple_insecure'></TD>
			<TD>
				insecure : <select id='edit_multiple_insecure' class="input8"><option value='port'>port</option><option value='port,invite'>very</option><option value='no'>no</option></select> <img src="images/tooltip_info.gif" tip="en,users,26" class='tooltipinfo'>
			</TD>
		</TR>
		
		<TR>
			<TD></TD>
			<TD><strong>Other Options:</strong></TD>
		</TR>

		<TR>
			<TD><input type=checkbox id='edit_check_multiple_3waycalling'></TD>
			<TD>
				<input type='checkbox' id='edit_multiple_3waycalling'>
				<label for='edit_multiple_3waycalling'>3-Way Calling</label>
				<img src="images/tooltip_info.gif" tip="en,users,14" class='tooltipinfo'>
			</TD>
		</TR>
		<TR>
			<TD><input type=checkbox id='edit_check_multiple_indirectory'></TD>
			<TD>
				<input type='checkbox' id='edit_multiple_indirectory'>
				<label for='edit_multiple_indirectory'>In Directory</label>
				<img src="images/tooltip_info.gif" tip="en,users,9" class='tooltipinfo'>
			</TD>
		</TR>
		<TR>
			<TD><input type=checkbox id='edit_check_multiple_callwaiting'></TD>
			<TD>
				<input type='checkbox' id='edit_multiple_callwaiting'>
				<label for='edit_multiple_callwaiting'>Call Waiting</label>
				<img src="images/tooltip_info.gif" tip="en,users,13" class='tooltipinfo'>
			</TD>
		</TR>

		<TR>
			<TD><input type=checkbox id='edit_check_multiple_cti'></TD>
			<TD>
				<input type='checkbox' id='edit_multiple_cti'>
				<label for='edit_multiple_cti'>CTI</label>
				<img src="images/tooltip_info.gif" tip="en,users,12" class='tooltipinfo'>
			</TD>
		</TR>
		
		<TR>
			<TD><input type=checkbox id='edit_check_multiple_isagent'> </TD>
			<TD>
				<input type='checkbox' id='edit_multiple_isagent'>
				<label for='edit_multiple_isagent'>Is Agent</label>
				<img src="images/tooltip_info.gif" tip="en,users,15" class='tooltipinfo'>
			</TD>
		</TR>

		<TR>
			<TD><input type=checkbox id='edit_check_multiple_pickupgroup'></TD>
			<TD>
				Pickup Group: <select id='edit_multiple_pickupgroup'></select>
			</TD>
		</TR>
		<TR>	<TD align=center valign=middle colspan=2>
				<span class='guiButtonCancel' onclick='ASTGUI.hideDrag(event);'>Cancel</span>
				<span class='guiButtonEdit' onclick='USERS_MISC_FUNCTIONS.save_multiple_users();'>Update</span>
			</TD>
		</TR>
	</TABLE>
</div>



<div style="display:none">
	<form name="buynow_form" id="buynow_form" action="http://www.digium.com/en/ecosystem/partners/partners.php" method="post"></form>
</div>

</body>
