<!--
 * Asterisk-GUI	- an Asterisk configuration interface
 *
 * Upload a custom voice menu prompt
 *
 * Copyright (C) 2008, Digium, Inc.
 *
 * Pari Nannapaneni <pari@digium.com>
 *
 * See http://www.asterisk.org for more information about
 * the Asterisk project. Please do not directly contact
 * any of the maintainers of this project for assistance;
 * the project provides a web site, mailing lists and IRC
 * channels for your use.
 *
 * This program is free software, distributed under the terms of
 * the GNU General Public License Version 2. See the LICENSE file
 * at the top of the source tree.
 *
-->
<script src="js/jquery.js"></script>
<script src="js/astman.js"></script>
<link href="stylesheets/schwing.css" media="all" rel="Stylesheet" type="text/css" />
<style type="text/css">
	#nocf {
		font-size: 13pt;
		border:1px solid;
		padding : 10;
		margin-left : 15;
		margin-right : 15;
		margin-top : 25;
		text-align: center;
	}

	#thispageContent{
		font-size: 10pt;
		padding : 5;
		margin-left : 15;
		margin-top : 15;
	}
</style>
<script>

var upload_Filename = ""; // will be updated by upload_form.html
var starteduploading = 0;
var upload_Path; // path for 'uploads' as defined in http.conf - this variable will be automatically updated from http.conf

onUploadForm_load = function(){
	if(!top.sessionData.httpConf.postmappings_defined || !top.sessionData.httpConf.uploadPaths['voicemenuprompts'] ){
		$('#uploadForm_container').hide();
		parent.ASTGUI.dialog.waitWhile( 'Creating configuration needed for uploading voice prompts ...' );

		var tmp_a = ASTGUI.paths.menusRecord.rChop('/');
		var u = new listOfSynActions('http.conf') ;
			if( !top.sessionData.httpConf.postmappings_defined ){
				u.new_action( 'newcat', 'post_mappings', '', '');
			}
			u.new_action('append', 'post_mappings', 'voicemenuprompts', tmp_a ) ;
			u.callActions();
			top.sessionData.httpConf.postmappings_defined = true ;
			top.sessionData.httpConf.uploadPaths['voicemenuprompts'] = tmp_a ;

		ASTGUI.cliCommand('reload');
		setTimeout(
			function(){
				parent.ASTGUI.dialog.hide();
				window.location.reload();
			}
		, 1000 ); // reload page
		return ;
	}

	var upload_action_path = (top.sessionData.httpConf.prefix) ? '/' + top.sessionData.httpConf.prefix + '/voicemenuprompts' : '/voicemenuprompts' ;
	_$('uploadiframe').contentWindow.document.getElementById('form22').action =  upload_action_path ;
}; 


onUploadForm_beforeUploading = function(){
	var tmp_fname = upload_Filename.toLowerCase();
	if( tmp_fname.endsWith('.wav') || tmp_fname.endsWith('.gsm') || tmp_fname.endsWith('.ulaw') || tmp_fname.endsWith('.alaw') ){
		starteduploading = 1;
		ASTGUI.dialog.waitWhile('File Upload in progress, please wait ..');
		return true;
	}else{
		starteduploading = 0;
		ASTGUI.feedback({ msg:'Sound file must be wav, gsm, ulaw or alaw !!', showfor: 3, color: 'red' });
		alert('Sound file must be wav, gsm, ulaw or alaw !');
		return false;
	}
};

onUploadForm_unload = function(){
	if(!starteduploading){ return; }
	ASTGUI.dialog.waitWhile('VoiceMenu prompt Uploaded');
	ASTGUI.feedback({ msg:'VoiceMenu prompt Uploaded !!', showfor: 3 });
	$('#uploadForm_container').hide();
	setTimeout( function(){
		ASTGUI.dialog.hide();
		window.location.href = 'menuprompts_record.html'; 
	} , 1000 );
	return;
};

function localajaxinit() {
	top.document.title = 'Upload a custom Voice Menu Prompt';

	parent.ASTGUI.dialog.waitWhile('Loading ...');
	parent.ASTGUI.systemCmd( "mkdir -p " + ASTGUI.paths.menusRecord , function(){
		parent.ASTGUI.dialog.hide();
	});

	ASTGUI.events.add( _$('BACKBUTTON') , 'click' , function(){ window.location.href = 'menuprompts_record.html' ;} );

};

</script>
<body bgcolor="EFEFEF">

<div class="iframeTitleBar">
	&nbsp;Upload a custom Voice Menu Prompt
	<span class='refresh_icon' onclick="window.location.reload();" >&nbsp;<img src="images/refresh.png" title=" Refresh " border=0 >&nbsp;</span>
</div>

<div class='top_buttons'>
	<span class='guiButton' id='BACKBUTTON' style='margin-left:200px;'> &#171 Back to 'List of Custom Voice Menu Prompts' </span>
</div>


<fieldset  style="font-size : 13px; width: 745px" id='uploadForm_container'>
	<legend><B>&nbsp;Choose voice prompt to upload :&nbsp;</B></legend>
	<IFRAME src="upload_form.html" id="uploadiframe" width="480" height="100" frameborder="0" border="0" marginheight="0" marginwidth="0"></IFRAME>
</fieldset>

</body>
