<!--
 * Asterisk-GUI	- an Asterisk configuration interface
 *
 * Manage VOIP trunks
 *
 * Copyright (C) 2006 - 2008, Digium, Inc.
 *
 * Pari Nannapaneni <pari@digium.com>
 *
 * See http://www.asterisk.org for more information about
 * the Asterisk project. Please do not directly contact
 * any of the maintainers of this project for assistance;
 * the project provides a web site, mailing lists and IRC
 * channels for your use.
 *
 * This program is free software, distributed under the terms of
 * the GNU General Public License Version 2. See the LICENSE file
 * at the top of the source tree.
 *
-->
<script src="js/jquery.js"></script>
<script src="js/astman.js"></script>
<script src="js/jquery.tooltip.js"></script>
<link href="stylesheets/schwing.css" media="all" rel="Stylesheet" type="text/css" />
<style type="text/css">

	#table_VOIPTrunks_list {
		border: 0px solid #666666;
		margin-top: 8px;
		padding : 1px;
		width: 96%;
	}

	#table_VOIPTrunks_list {
		border: 1px solid #666666;
		margin-top: 5px;
		margin-bottom:10px;
		width: 96%;
		text-align: center;
		padding : 1px;
	}
	#table_VOIPTrunks_list tr.frow { background: #6b79a5; color: #CED7EF; }
	#table_VOIPTrunks_list tr.frow td{ font-weight:bold; }
	#table_VOIPTrunks_list tr td{ padding : 3px; }
	#table_VOIPTrunks_list tr.even { background: #DFDFDF; }
	#table_VOIPTrunks_list tr.odd{ background: #FFFFFF; }
	#table_VOIPTrunks_list tr.even:hover, #table_VOIPTrunks_list tr.odd:hover {
		background: #a8b6e5;
		cursor: default;
	}


#div_INR_LIST {
	text-align:left;
	height:200px;
	width:96%;
	border-width: 1px;
	border-color: #7E5538;
	border-style: solid;
	overflow: auto;
}

#div_INR_LIST div {
	clear: both;
	padding : 3px 5px 0px 5px;
	min-height: 20px;
}

#div_INR_LIST div:hover{
	background-color:#DEDEDE;
}

#div_INR_LIST div span.rule_desc {
	padding: 2px 3px 2px 5px;
	float: left;
	background: transparent;
}

#div_INR_LIST div span.rule_delete {
	float: right;
	width: 20px;
	background: transparent url("./images/delete_circle.png") no-repeat;
}

</style>
<script>
var isNewTrunk ;
var EDIT_TRUNK ;
var EDIT_DID = '';
var EDIT_DID_rules = [];
var EDIT_TRUNK_luser = '' ; // old mwi luser


var loadDOMelements = function (){
	DOM_table_VOIPTrunks_list = _$('table_VOIPTrunks_list');
	DOM_edit_VOIPTrunk_DIV = _$('edit_VOIPTrunk_DIV');
	DOM_edit_VOIPTrunk_DIV_Title = _$('edit_VOIPTrunk_DIV_Title');
	DOM_edit_VOIPTrunk_Type = _$('edit_VOIPTrunk_Type');
	DOM_edit_VOIPTrunk_Context_Basis = _$('edit_VOIPTrunk_Context_Basis');
	DOM_edit_VOIPTrunk_Hostname = _$('edit_VOIPTrunk_Hostname');
	DOM_edit_VOIPTrunk_Username = _$('edit_VOIPTrunk_Username');
	DOM_edit_VOIPTrunk_Password = _$('edit_VOIPTrunk_Password');
};



var new_trunk_form = function(){
	$('.editTrunk_Field').hide();
	$('.editTrunk_Field_ermwi').hide();
	isNewTrunk = true;
	EDIT_TRUNK = '';
	show_Edit_Trunk();
};



var edit_trunk_form = function(ET){
	$('.editTrunk_Field').show();
	//$('.editTrunk_Field_ermwi').show();
	EDIT_TRUNK = ET ;
	isNewTrunk = false ;
	show_Edit_Trunk();
};



var show_Edit_Trunk = function(){
	ASTGUI.updateFieldToValue( 'codec_one', '' );
	ASTGUI.updateFieldToValue( 'codec_two', '' );
	ASTGUI.updateFieldToValue( 'codec_three', '' );
	ASTGUI.updateFieldToValue( 'codec_fourth', '' );
	ASTGUI.updateFieldToValue( 'codec_fifth', '' );

	if( isNewTrunk == true ) {
		DOM_edit_VOIPTrunk_DIV_Title.innerHTML = 'Create New SIP/IAX trunk';
		ASTGUI.resetTheseFields([ DOM_edit_VOIPTrunk_Type, DOM_edit_VOIPTrunk_Hostname , DOM_edit_VOIPTrunk_Username ,  DOM_edit_VOIPTrunk_Password , 'trunk_obcid' , 'edit_VOIPTrunk_Providername','trunk_fromdomain', 'trunk_fromuser', 'trunk_insecure' ]);
		DOM_edit_VOIPTrunk_Type.disabled = false;
		DOM_edit_VOIPTrunk_Context_Basis.disabled = false;
		ASTGUI.feedback( { msg: 'Create New Trunk', showfor:2 });
		$('#TR_trunktype').show();
		$('#TR_contextbasis').show();
	} else {
		$('#TR_trunktype').hide();
		$('#TR_contextbasis').hide();
		var ttype = parent.astgui_managetrunks.misc.getTrunkType(EDIT_TRUNK) ;
		var tinfo = parent.sessionData.pbxinfo.trunks[ttype][EDIT_TRUNK];

		DOM_edit_VOIPTrunk_Type.disabled = true;
		DOM_edit_VOIPTrunk_Context_Basis.disabled = true;
		DOM_edit_VOIPTrunk_DIV_Title.innerHTML = 'Edit ' + ttype.toUpperCase() + ' trunk ' + EDIT_TRUNK;
		ASTGUI.updateFieldToValue( DOM_edit_VOIPTrunk_Type, ttype.toUpperCase() );
		ASTGUI.updateFieldToValue( DOM_edit_VOIPTrunk_Hostname , tinfo.getProperty('host') );
		ASTGUI.updateFieldToValue( DOM_edit_VOIPTrunk_Username , tinfo.getProperty('username') );
		ASTGUI.updateFieldToValue( DOM_edit_VOIPTrunk_Password , tinfo.getProperty('secret') );
		ASTGUI.updateFieldToValue( 'edit_VOIPTrunk_Providername' , tinfo.getProperty('trunkname') );
		ASTGUI.updateFieldToValue( 'trunk_fromdomain' , tinfo.getProperty('fromdomain') );
		ASTGUI.updateFieldToValue( 'trunk_fromuser' , tinfo.getProperty('fromuser') );
		ASTGUI.updateFieldToValue( 'trunk_insecure' , tinfo.getProperty('insecure') );

		if( tinfo.getProperty('allow') == 'all'){
			ASTGUI.updateFieldToValue( 'codec_one', 'ulaw' );
			ASTGUI.updateFieldToValue( 'codec_two', 'alaw' );
			ASTGUI.updateFieldToValue( 'codec_three', 'gsm' );
			ASTGUI.updateFieldToValue( 'codec_fourth', 'g726' );
			ASTGUI.updateFieldToValue( 'codec_fifth', 'g722' );
		}else{
			var codecs_tmp = tinfo.getProperty('allow').split(',') ;
			ASTGUI.updateFieldToValue( 'codec_one', (codecs_tmp[0] && codecs_tmp[0].trim()) || '' );
			ASTGUI.updateFieldToValue( 'codec_two', (codecs_tmp[1] && codecs_tmp[1].trim()) || '' );
			ASTGUI.updateFieldToValue( 'codec_three', (codecs_tmp[2] && codecs_tmp[2].trim()) || '' );
			ASTGUI.updateFieldToValue( 'codec_fourth', (codecs_tmp[3] && codecs_tmp[3].trim()) || '' );
			ASTGUI.updateFieldToValue( 'codec_fifth', (codecs_tmp[4] && codecs_tmp[4].trim()) || '' );
		}

		/* Don't allow editing field if the asterisk [context] is based on it. */
		DOM_edit_VOIPTrunk_Username.disabled = false;
		_$('edit_VOIPTrunk_Providername').disabled = false;
		if (EDIT_TRUNK == tinfo.getProperty('username')) DOM_edit_VOIPTrunk_Username.disabled = true;
		if (EDIT_TRUNK == tinfo.getProperty('trunkname')) _$('edit_VOIPTrunk_Providername').disabled = true;

		var c = context2json({ filename:'extensions.conf', context: 'globals' , usf: 1 });
		ASTGUI.updateFieldToValue( 'trunk_obcid', c.getProperty(ASTGUI.globals.obcidUsrPrefix + EDIT_TRUNK) );


		// remote MWI stuff (only for SIP trunks)
			if ( ttype == 'sip' ){
				$('.editTrunk_Field_ermwi').show();
			}else{
				$('.editTrunk_Field_ermwi').hide();
			}
			(function(){
				_$('edit_ERMWI_luser').selectedIndex = -1 ;
				var mwi_user = '';

				var d = config2json({ filename:'users.conf', usf: 1 });
				c = d[EDIT_TRUNK];
				if ( c.hasOwnProperty('mwi') ){
					ASTGUI.updateFieldToValue( 'edit_ERMWI' , 'yes' );
					$('#editTrunk_Field_ermwi_row2').show();
					var ruser = c['mwi'].afterChar('/');
					ASTGUI.updateFieldToValue( 'edit_ERMWI_rmbx' ,  ruser );
				}else{
					$('#editTrunk_Field_ermwi_row2').hide();
					_$('edit_ERMWI').checked = false ;
					ASTGUI.updateFieldToValue('edit_ERMWI_rmbx' , '');
				}

				for( var this_user in d ){ if( d.hasOwnProperty(this_user) ){
					if ( d[this_user].getProperty('mailbox').contains('MailboxStore') &&  d[this_user].getProperty('mailbox').contains(ruser) ){
						ASTGUI.updateFieldToValue( 'edit_ERMWI_luser' , this_user );
						EDIT_TRUNK_luser = this_user;
					}
				}}
			})();

		// End of 'remote MWI stuff'
		ASTGUI.feedback( { msg:'Edit Trunk', showfor: 2 });
	}
	$(DOM_edit_VOIPTrunk_DIV).showWithBg();
};


var edit_VOIPTrunk_save_go = function(){
	var topreload = false;
	var tmp_username = ASTGUI.getFieldValue('edit_VOIPTrunk_Username');
	if( /[^a-zA-Z_0-9\.]/.test(tmp_username) ){
		var tmp_confirm = confirm('The Voip Username appears to contain special characters. \n Click \'OK\' to continue, \'Cancel\' to abort.');
		if( !tmp_confirm ) return;
	}

	if ( !ASTGUI.checkRequiredFields(['edit_VOIPTrunk_Providername', 'edit_VOIPTrunk_Type', 'edit_VOIPTrunk_Context_Basis', 'edit_VOIPTrunk_Hostname']) ) {
		return ;
	}

	if( isNewTrunk == true ) {
	// New Trunk
		var tcv = edit_VOIPTrunk_Context_Basis.value;  /* How do we assign context name ? */
		if (tcv == 'FromUser') {
			var tmp_ttype = parent.astgui_managetrunks.misc.getTrunkType( DOM_edit_VOIPTrunk_Username.value );
			if( tmp_ttype ){
				ASTGUI.highlightField( DOM_edit_VOIPTrunk_Username , "Another trunk exists with this name !!" );
				return;
			}
		}
		else if (tcv == 'FromProvider') {
			var tmp_ttype = parent.astgui_managetrunks.misc.getTrunkType( ASTGUI.getFieldValue('edit_VOIPTrunk_Providername') );
			if( tmp_ttype ){
				ASTGUI.highlightField( 'edit_VOIPTrunk_Providername' , "Another trunk exists with this name !!" );
				return;
			}
		}

		var ttv = DOM_edit_VOIPTrunk_Type.value;

		var trp = {
			host: 	  DOM_edit_VOIPTrunk_Hostname.value ,
			username: DOM_edit_VOIPTrunk_Username.value ,
			secret:   DOM_edit_VOIPTrunk_Password.value ,
			trunkname: ASTGUI.getFieldValue('edit_VOIPTrunk_Providername')
		};

		var cbf = function(){
			ASTGUI.feedback({msg:'Created New ' + ttv+ ' trunk !', showfor: 3 , color: 'green', bgcolor: '#FFFFFF'}) ;
			window.location.reload();
		};

		if(ttv =='SIP'){ parent.astgui_managetrunks.addSIPTrunk( trp , cbf,
						DOM_edit_VOIPTrunk_Context_Basis.value ) ; }
		if(ttv =='IAX'){ parent.astgui_managetrunks.addIAXTrunk( trp , cbf,
						DOM_edit_VOIPTrunk_Context_Basis.value ) ; }

	}else if(isNewTrunk == false){
	// Edit Existing Trunk
		parent.ASTGUI.dialog.waitWhile(' Saving ...') ;
			var codecs = '';
			if( ASTGUI.getFieldValue('codec_one') ){ codecs = codecs + ASTGUI.getFieldValue('codec_one') }
			if( ASTGUI.getFieldValue('codec_two') ){ codecs = codecs + ',' + ASTGUI.getFieldValue('codec_two') }
			if( ASTGUI.getFieldValue('codec_three') ){ codecs = codecs + ',' + ASTGUI.getFieldValue('codec_three') }
			if( ASTGUI.getFieldValue('codec_fourth') ){ codecs = codecs + ',' + ASTGUI.getFieldValue('codec_fourth') }
			if( ASTGUI.getFieldValue('codec_fifth') ){ codecs = codecs + ',' + ASTGUI.getFieldValue('codec_fifth') }

		var ttype = parent.astgui_managetrunks.misc.getTrunkType(EDIT_TRUNK) ;
		var x = new listOfActions('users.conf');
		var v = new listOfActions('extensions.conf') ;

		if( ASTGUI.getFieldValue('trunk_obcid') ){
			v.new_action('update', 'globals', ASTGUI.globals.obcidUsrPrefix + EDIT_TRUNK, ASTGUI.getFieldValue('trunk_obcid') );
		}else{
			v.new_action('delete', 'globals', ASTGUI.globals.obcidUsrPrefix + EDIT_TRUNK, '','' );
		}

		var old_trunkUsername = parent.sessionData.pbxinfo.trunks[ttype][EDIT_TRUNK]['username'] ;

		x.new_action('update', EDIT_TRUNK , 'host', ASTGUI.getFieldValue(DOM_edit_VOIPTrunk_Hostname) );
			parent.sessionData.pbxinfo.trunks[ttype][EDIT_TRUNK]['host'] = ASTGUI.getFieldValue(DOM_edit_VOIPTrunk_Hostname) ;


		(function(){
			var tmp_fromdomain = ASTGUI.getFieldValue('trunk_fromdomain') ;
			if( tmp_fromdomain ){
				x.new_action('update', EDIT_TRUNK , 'fromdomain', tmp_fromdomain );
				parent.sessionData.pbxinfo.trunks[ttype][EDIT_TRUNK]['fromdomain'] = tmp_fromdomain ;
			}else{
				if( parent.sessionData.pbxinfo.trunks[ttype][EDIT_TRUNK].hasOwnProperty('fromdomain') ){
					delete parent.sessionData.pbxinfo.trunks[ttype][EDIT_TRUNK]['fromdomain'] ;
				}
			}
	
			var tmp_fromuser = ASTGUI.getFieldValue('trunk_fromuser') ;
			if( tmp_fromuser ){
				x.new_action('update', EDIT_TRUNK , 'fromuser', tmp_fromuser );
				parent.sessionData.pbxinfo.trunks[ttype][EDIT_TRUNK]['fromuser'] = tmp_fromuser ;
			}else{
				if( parent.sessionData.pbxinfo.trunks[ttype][EDIT_TRUNK].hasOwnProperty('fromuser') ){
					delete parent.sessionData.pbxinfo.trunks[ttype][EDIT_TRUNK]['fromuser'] ;
				}
			}

			var tmp_insecure = ASTGUI.getFieldValue('trunk_insecure') ;
			x.new_action('update', EDIT_TRUNK , 'insecure', tmp_insecure );
			parent.sessionData.pbxinfo.trunks[ttype][EDIT_TRUNK]['insecure'] = tmp_insecure ;
		})();


		x.new_action('update', EDIT_TRUNK , 'secret', ASTGUI.getFieldValue(DOM_edit_VOIPTrunk_Password) );
			parent.sessionData.pbxinfo.trunks[ttype][EDIT_TRUNK]['secret'] = ASTGUI.getFieldValue(DOM_edit_VOIPTrunk_Password) ;
		x.new_action('update', EDIT_TRUNK , 'username', ASTGUI.getFieldValue(DOM_edit_VOIPTrunk_Username) );
			parent.sessionData.pbxinfo.trunks[ttype][EDIT_TRUNK]['username'] = ASTGUI.getFieldValue(DOM_edit_VOIPTrunk_Username) ;
		x.new_action('update', EDIT_TRUNK , 'trunkname', ASTGUI.getFieldValue('edit_VOIPTrunk_Providername').guiMetaData() );
			parent.sessionData.pbxinfo.trunks[ttype][EDIT_TRUNK]['trunkname'] = ASTGUI.getFieldValue('edit_VOIPTrunk_Providername') ;
		x.new_action('delete', EDIT_TRUNK, 'disallow', '') ;
		x.new_action('delete', EDIT_TRUNK, 'allow', '') ;
		x.new_action('append', EDIT_TRUNK, 'disallow', 'all') ;		parent.sessionData.pbxinfo.trunks[ttype][EDIT_TRUNK]['disallow'] = 'all' ;
		if( !codecs ){
			x.new_action('append', EDIT_TRUNK, 'allow', 'all' ) ;	parent.sessionData.pbxinfo.trunks[ttype][EDIT_TRUNK]['allow'] = 'all' ;
		}else{
			x.new_action('append', EDIT_TRUNK, 'allow', codecs ) ;	parent.sessionData.pbxinfo.trunks[ttype][EDIT_TRUNK]['allow'] = codecs ;
		}

		// remote MWI - only for SIP trunk
			if ( ttype == 'sip' ){
				var ruser = ASTGUI.getFieldValue('edit_ERMWI_rmbx') ;
				var luser = ASTGUI.getFieldValue('edit_ERMWI_luser') ;

				if ( _$('edit_ERMWI').checked && ruser){
					var tmp_mwistr= ASTGUI.getFieldValue(DOM_edit_VOIPTrunk_Username) + ':'+ ASTGUI.getFieldValue(DOM_edit_VOIPTrunk_Password) + '@' + ASTGUI.getFieldValue(DOM_edit_VOIPTrunk_Hostname) + '/' + ruser ;
					tmp_luser_mailbox = 'MailboxStore:'+ ruser ;

					x.new_action('update', EDIT_TRUNK , 'mwi', tmp_mwistr );
						parent.sessionData.pbxinfo.trunks[ttype][EDIT_TRUNK]['mwi'] = tmp_mwistr ;
					x.new_action('update', luser , 'mailbox', tmp_luser_mailbox );
						parent.sessionData.pbxinfo.users[luser].mailbox = tmp_luser_mailbox;
					x.new_action('update', luser , 'hasvoicemail', 'yes' );
						parent.sessionData.pbxinfo.users[luser].hasvoicemail = 'yes';

					if ( EDIT_TRUNK_luser && EDIT_TRUNK_luser != luser && parent.sessionData.pbxinfo.users.hasOwnProperty(EDIT_TRUNK_luser) ){
						x.new_action('update', EDIT_TRUNK_luser , 'mailbox', EDIT_TRUNK_luser );
						parent.sessionData.pbxinfo.users[EDIT_TRUNK_luser].mailbox = EDIT_TRUNK_luser;
					}
				}else{
					x.new_action('delete', EDIT_TRUNK , 'mwi', '','' );
						delete parent.sessionData.pbxinfo.trunks[ttype][EDIT_TRUNK].mwi ;
					if ( EDIT_TRUNK_luser && parent.sessionData.pbxinfo.users.hasOwnProperty(EDIT_TRUNK_luser) ){
						x.new_action('update', EDIT_TRUNK_luser , 'mailbox', EDIT_TRUNK_luser );
						parent.sessionData.pbxinfo.users[EDIT_TRUNK_luser].mailbox = EDIT_TRUNK_luser;
					}
				}

			}
		// End of remote MWI

		var after = function(){
			v.callActions( function(){
				parent.ASTGUI.dialog.hide() ;
				ASTGUI.feedback({ msg:'Saved Changes !!', showfor: 3 , color: 'green', bgcolor: '#FFFFFF' }) ;
				if( topreload ){
					top.window.location.reload();
				}else{
					window.location.reload();
				}
			});
		};

		x.callActions(after);
	}
};



var delete_trunk_confirm = function(ET){
	EDIT_TRUNK = ET ;
	if(!EDIT_TRUNK){return;}
	var ttype = parent.astgui_managetrunks.misc.getTrunkType(EDIT_TRUNK) ;
	var tmp_name = parent.sessionData.pbxinfo.trunks[ttype][EDIT_TRUNK]['trunkname'] + ' -- ' + EDIT_TRUNK ;
	if(! confirm(' Delete VOIP trunk "' + tmp_name + '" ?' ) ){return;}
	parent.astgui_managetrunks.deletetrunk(EDIT_TRUNK) ;
	ASTGUI.feedback( { msg:'deleted VOIP Trunk ' + tmp_name, showfor: 5, color:'red', bgcolor:'#FFFFFF' } );
	window.location.reload();
};


var load_VOIPTrunksTable = function (){
	var addCell = ASTGUI.domActions.tr_addCell; // temporarily store the function
	(function(){ // add first row
		var newRow = DOM_table_VOIPTrunks_list.insertRow(-1);
		newRow.className = "frow";
		addCell( newRow , { html:'Provider Name'} );
		addCell( newRow , { html:'Type'} ); // sip/iax
		addCell( newRow , { html:'Hostname/IP'} ); // Hostname
		addCell( newRow , { html:'Username'} ); // Hostname
		addCell( newRow , { html: '' } );
	})();
	(function (){
		var c = [] ;
		var d = c.concat( parent.astgui_managetrunks.listOfSIPTrunks() , parent.astgui_managetrunks.listOfIAXTrunks() );
		d.each(function(item){
			var ttype = parent.astgui_managetrunks.misc.getTrunkType(item) ;
			var newRow = DOM_table_VOIPTrunks_list.insertRow(-1);
			newRow.className = ((DOM_table_VOIPTrunks_list.rows.length)%2==1)?'odd':'even';

			addCell( newRow , { html: parent.sessionData.pbxinfo.trunks[ttype][item]['trunkname'] } );
			addCell( newRow , { html: ttype.toUpperCase() }); // sip/iax
			addCell( newRow , { html: parent.sessionData.pbxinfo.trunks[ttype][item]['host'] });
			addCell( newRow , { html: parent.sessionData.pbxinfo.trunks[ttype][item]['username'] || '' });

			var tmp_editString = "<span class='guiButton' onclick=\"edit_trunk_form('" + item +"')\">Edit</span>&nbsp;"
						+ "<span class='guiButtonDelete' onclick=\"delete_trunk_confirm('" + item +"')\">Delete</span>" ;
			addCell( newRow , { html: tmp_editString });
		});
	})();

	if( DOM_table_VOIPTrunks_list.rows.length == 1  ){
		ASTGUI.domActions.clear_table(DOM_table_VOIPTrunks_list);
		var newRow = DOM_table_VOIPTrunks_list.insertRow(-1);
		addCell( newRow , { html: "<BR><B>No SIP/IAX Trunks defined</B><BR><BR>" } );
	}
};



var localajaxinit = function(){
	top.document.title = 'Manage custom SIP/IAX Trunks ' ;
	(function (){ // populate TABS
		var tmp_providersPage = ( parent.sessionData.PLATFORM.isAA50 || parent.sessionData.PLATFORM.isABE ) ? 'trunks_sps.html' : 'trunks_providers.html';
		var t = [];
		if( !parent.sessionData.PLATFORM.AA50_SKU.contains('800') ){
			t.push({ url: 'trunks_analog.html', desc: 'Analog Trunks' });
		};
		t.push({ url: tmp_providersPage , desc:'Service Providers' });
		t.push({ url:'#', desc:'VOIP Trunks', selected:true });
		if( !parent.sessionData.PLATFORM.isAA50 ){
			t.push ({url:'trunks_digital.html', desc:'T1/E1/BRI Trunks'} );
		}
		ASTGUI.tabbedOptions( _$('tabbedMenu') , t);

		var R = [];
		R.push( {optionText:'None', optionValue :'' } );
		for ( var r in parent.sessionData.listOfCodecs ){
			R.push( {optionText: parent.sessionData.listOfCodecs[r] , optionValue : r });
		}
		ASTGUI.selectbox.populateArray('codec_one', R);
		ASTGUI.selectbox.populateArray('codec_two', R);
		ASTGUI.selectbox.populateArray('codec_three', R);
		ASTGUI.selectbox.populateArray('codec_fourth', R);
		ASTGUI.selectbox.populateArray('codec_fifth', R);
	})(); // end of populate TABS
	(function(){
		var tmp = [] ;
		var destination = function(){
			this.optionText = '' ;
			this.optionValue = '' ;
		};

		var y = parent.astgui_manageusers.listOfUsers();
		y.each(function(user){
			var f = new destination;
			f.optionText = f.optionValue = user ;
			tmp.push(f);
		});
		
		ASTGUI.selectbox.populateArray( 'edit_ERMWI_luser', tmp );
		ASTGUI.domActions.showHideByCheckBox ( 'edit_ERMWI', 'editTrunk_Field_ermwi_row2' ) ;
	})();
	loadDOMelements();
	load_VOIPTrunksTable();
};

</script>
<body bgcolor="EFEFEF">
<div class="iframeTitleBar">
	Manage SIP & IAX trunks
	<span class='refresh_icon' onclick="window.location.reload();" >&nbsp;<img src="images/refresh.png" title=" Refresh " border=0 >&nbsp;</span>
</div>

<div id="tabbedMenu"></div>

<div class='top_buttons' style="margin-top: -10px;">
	<span id='edit_voiptrunk_button' class='guiButtonNew' onclick="new_trunk_form();">New SIP/IAX Trunk</span>
</div>

<table id='table_VOIPTrunks_list' cellpadding=0 cellspacing=0 border=0 align=center></table>

<div id="edit_VOIPTrunk_DIV" STYLE="width:620; display:none;" class='dialog'>
	<TABLE width="100%" cellpadding=0 cellspacing=0>
	<TR class="dialog_title_tr">
		<TD class="dialog_title" onmousedown="ASTGUI.startDrag(event);">
			<span id='edit_VOIPTrunk_DIV_Title'></span>
		</TD>
		<TD class="dialog_title_X" onclick="ASTGUI.hideDrag(event);"> X </TD>
	</TR>
	</TABLE>
	<TABLE align=center cellpadding=2 cellspacing=2 border=0>

	<TR id='TR_trunktype'>
		<TD align="right">Type:</TD>
		<TD>	<select id='edit_VOIPTrunk_Type'  required='yes'>
				<option value='SIP'>SIP</option>
				<option value='IAX'>IAX</option>
			</select>
		</TD>
	</TR>
	
	<TR id='TR_contextbasis'>
		<TD align="right">Context Naming <img src="images/tooltip_info.gif" tip="en,trunks,40" class='tooltipinfo'>:</TD>
		<TD>	<select id='edit_VOIPTrunk_Context_Basis'  required='yes'>
				<option value='GUIAssigned' selected>Assigned by Asterisk GUI</option>
				<option value='FromUser'>Based on Username</option>
				<option value='FromProvider'>Based on Provider Name</option>
			</select>
		</TD>
	</TR>

	<TR>	<TD align="right">Provider Name <img src="images/tooltip_info.gif" tip="en,trunks,37" class='tooltipinfo'>:</TD>
		<TD>	<input id='edit_VOIPTrunk_Providername' size=20 required='yes'></TD>
	</TR>

	<TR>	<TD align="right">Hostname <img src="images/tooltip_info.gif" tip="en,trunks,41" class='tooltipinfo'>:</TD>
		<TD>	<input id='edit_VOIPTrunk_Hostname' size=30 required='yes'></TD>
	</TR>
	<TR>	<TD align="right">Username <img src="images/tooltip_info.gif" tip="en,trunks,39" class='tooltipinfo'>:</TD>
		<TD>	<input id='edit_VOIPTrunk_Username' size=25  required='yes' validation='voipusername'></TD>
	</TR>
	<TR>	<TD align="right">Password :</TD>
		<TD>	<input id='edit_VOIPTrunk_Password' size=25 required='yes'></TD>
	</TR>

	<TR class='editTrunk_Field'>
		<TD align="right" valign=top>Codecs :</TD>
		<TD align="left">
			First : <select id='codec_one'></select>
			Second : <select id='codec_two'></select>
			Third : <select id='codec_three'></select><BR>
			Fourth : <select id='codec_fourth'></select>
			Fifth : <select id='codec_fifth'></select>
		</TD>
	</TR>

	<TR  class='editTrunk_Field'>
		<TD align="right" valign=top>CallerID <img src="images/tooltip_info.gif" tip="en,trunks,36" class='tooltipinfo'> :</TD>
		<TD align="left">	<input id="trunk_obcid" size=16>	</TD>
	</TR>

	<TR class='editTrunk_Field'>
		<TD align="right" valign=top>FromDomain :</TD>
		<TD align="left"> <input id="trunk_fromdomain" size=16> </TD>
	</TR>

	<TR class='editTrunk_Field'>
		<TD align="right" valign=top>FromUser :</TD>
		<TD align="left"> <input id="trunk_fromuser" size=16> </TD>
	</TR>

	<TR class='editTrunk_Field'>
		<TD align="right" valign=top>insecure :</TD>
		<TD align="left"> <select id="trunk_insecure" dfalt='no' class="input8"><option value='port'>port</option><option value='port,invite'>very</option><option value='no'>no</option></select> </TD>
	</TR>

	<TR class='editTrunk_Field_ermwi'>
		<TD align="right">
			<input type='checkbox' id='edit_ERMWI'> Enable Remote MWI :
		</TD>
		<TD></TD>
	</TR>

	<TR class='editTrunk_Field_ermwi' id='editTrunk_Field_ermwi_row2'>
		<TD align="right"> Remote MailBox : </TD>
		<TD> <input id='edit_ERMWI_rmbx' size=4> 
			Local User : <select id='edit_ERMWI_luser'></select>
		</TD>
	</TR>

	<TR>	<TD colspan=2 align=center height=50 valign=middle>
			<span class='guiButtonCancel' id="edit_VOIPTrunk_cancel"  onclick='ASTGUI.hideDrag(event);'>Cancel</span>
			<span class='guiButtonEdit' id="edit_VOIPTrunk_save"  onclick='edit_VOIPTrunk_save_go();'>Save</span>
		</TD>
	</TR>
	</TABLE>
</div>

</body>
