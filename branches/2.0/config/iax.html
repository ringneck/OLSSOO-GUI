<!--
 * Asterisk-GUI	- an Asterisk configuration interface
 *
 * Global IAX settings
 *
 * Copyright (C) 2007-2008, Digium, Inc.
 *
 * Pari Nannapaneni <pari@digium.com>
 *
 * See http://www.asterisk.org for more information about
 * the Asterisk project. Please do not directly contact
 * any of the maintainers of this project for assistance;
 * the project provides a web site, mailing lists and IRC
 * channels for your use.
 *
 * This program is free software, distributed under the terms of
 * the GNU General Public License Version 2. See the LICENSE file
 * at the top of the source tree.
 *
-->
<script src="js/jquery.js"></script>
<script src="js/astman.js"></script>
<link href="stylesheets/schwing.css" media="all" rel="Stylesheet" type="text/css" />
<style type="text/css">

</style>
<script>
//Realtime :  'rtcachefriends', 'rtignoreexpire', 'rtupdate', 'rtautoclear' 
// CDR: amaflags, accountcode

var fieldnames = [ 'adsi', 'authdebug', 'autokill', 'bandwidth', 'bindaddr', 'bindport', 'codecpriority', 'delayreject', 'dropcount', 'forcejitterbuffer', 'iaxcompat', 'iaxmaxthreadcount', 'iaxthreadcount', 'jitterbuffer', 'jittershrinkrate', 'language', 'maxexcessbuffer', 'maxjitterbuffer', 'maxjitterinterps', 'maxregexpire', 'minexcessbuffer', 'minregexpire', 'mohinterpret', 'mohsuggest', 'nochecksums','resyncthreshold', 'tos', 'trunkfreq', 'trunktimestamps' ];

var localajaxinit = function(){
	top.document.title = 'global IAX settings' ;
	(function(){
		var hideall = function(){
			$('#iaxoptions_general').hide() ;
			//$('#iaxoptions_cdr').hide() ;
			$('#iaxoptions_jitterBuffer').hide() ;
			$('#iaxoptions_trunkregistration').hide() ;
			//$('#iaxoptions_realtime').hide() ;
			$('#iaxoptions_Codecs').hide() ;
		};

		var t = [
			{url:'#', desc:'General', click_function: function(){ hideall(); $('#iaxoptions_general').show(); }  } ,
			//{url:'#', desc:'CDR', click_function: function(){ hideall(); $('#iaxoptions_cdr').show(); } },
			{url:'#', desc:'Jitter Buffer', click_function: function(){ hideall(); $('#iaxoptions_jitterBuffer').show();} },
			{url:'#', desc:'Registration', click_function: function(){ hideall(); $('#iaxoptions_trunkregistration').show(); } },
			//{url:'#', desc:'Realtime', click_function: function(){ hideall(); $('#iaxoptions_realtime').show(); } },
			{url:'#', desc:'Codecs', click_function: function(){ hideall(); $('#iaxoptions_Codecs').show(); } }
		];
		ASTGUI.tabbedOptions( _$('tabbedMenu') , t );
		$('#tabbedMenu').find('A:eq(0)').click();
	})();


	var c = context2json({ filename:'iax.conf' , context : 'general' , usf:1 });
	var AU = ASTGUI.updateFieldToValue ; // temporarily cache function
	fieldnames.each( function(fld){
		var val = ( c[fld] ) ? c[fld] : '';
		AU(fld,val) ;
	});
	var disallowed = false;
	var real_codecs;
	ASTGUI.CODECSLIST.populateCodecsList(_$('allow'));
	if( c.hasOwnProperty('allow') ){ real_codecs = c['array']; }
	if( c.hasOwnProperty('disallow') ) { disallowed = c['disallow'].split(','); } 
	var default_selected = ['ulaw','alaw','gsm'];
	default_selected.each( function(val) {
		if (!disallowed.contains(val)) {
			real_codecs = real_codecs + "," + val;
		}
	});
	ASTGUI.CODECSLIST.selectCodecs(_$('allow'), real_codecs);
}


var saveChanges = function(){
	var cat = 'general';
	var after = function(){
		parent.ASTGUI.dialog.hide();
		ASTGUI.feedback({ msg:'Changes Saved !', showfor:2 });
	};
	var skip_ifempty = ['register', 'localnet', 'externhost', 'externip'];
	var x = new listOfActions('iax.conf');
	var AG = ASTGUI.getFieldValue;
	fieldnames.each( function(fld){
		var val = AG(fld) ;
		if (skip_ifempty.contains(fld)) {
			if (val.trim() == "") {
				return;
			}
		}
		x.new_action('update', cat , fld , val) ;
	});
	x.new_action('delete', cat , 'disallow', '' ) ;
	x.new_action('delete', cat , 'allow', '' ) ;
	x.new_action('append', cat , 'disallow', 'all' ) ;
	x.new_action('append', cat , 'allow', ASTGUI.CODECSLIST.getSelectedCodecs(_$('allow')) ) ;

	parent.ASTGUI.dialog.waitWhile(' Saving ...');
	setTimeout( function(){ x.callActions(after) ; } , 300 );
}



</script>
<body bgcolor="EFEFEF">
<div class="iframeTitleBar">
	IAX (Inter Asterisk Exchange Protocol) Configuration
	<span style="cursor: pointer; cursor: hand;" onclick="window.location.reload();" >&nbsp;<img src="images/refresh.png" title=" Refresh " border=0 >&nbsp;</span>
</div>

<center>
	<div id="tabbedMenu"></div>
	
	<div style='width: 800px;'>
	
		<div id='iaxoptions_general' style='display: none;'>
			<table class="field_text" align="center" width="100%" cellpadding=3 cellspacing=0 border=0>
			<tr>	<td align=right tip="en,iax_general,0" width="50%">Bind Port:</td>
					<td>&nbsp;<input type='text' size=4 id='bindport' dfalt='4569' pattern='^\d*$' class="input8"></td>
			</tr>
			<tr>	<td align=right tip="en,iax_general,1">Bind Address:</td>
					<td>&nbsp;<input type='text' size=14 dfalt='' id='bindaddr' class="input8"></td>
			</tr>
			<tr>	<td align=right tip="en,iax_general,2">IAX1 Compatibility:</td>
					<td><input type='checkbox' id='iaxcompat' dfalt='n'></td>
			</tr>
			<tr>	<td align=right tip="en,iax_general,3">No Checksums:</td>
					<td><input type='checkbox' id='nochecksums' dfalt='n'></td>
			</tr>
			<tr>	<td align=right tip="en,iax_general,4">Delay Reject:</td>
					<td><input type='checkbox' id='delayreject' dfalt='n'></td>
			</tr>
			<tr>	<td align=right tip="en,iax_general,5">ADSI:</td>
					<td><input type='checkbox' dfalt='n' id='adsi'></td>
			</tr>
			<tr>	<td align=right tip="en,iax_general,8">Music On Hold Interpret:</td>
					<td>&nbsp;<input type='text' size=14 id='mohinterpret' dfalt='default' class="input8"></td>
			</tr>
			<tr>	<td align=right tip="en,iax_general,9">Music On Hold Suggest:</td>
					<td>&nbsp;<input type='text' size=14 id='mohsuggest' class="input8"></td>
			</tr>
			<tr>	<td align=right tip="en,iax_general,10">Language:</td>
					<td>&nbsp;<input type='text' size=3 dfalt='en' id='language' class="input8"></td>
			</tr>	
			<tr>	<td align=right tip="en,iax_general,11">Bandwidth:</td>
					<td>&nbsp;<select id="bandwidth" class="input8">
						<option value="low">low</option>
						<option value="medium">medium</option>
						<option value="high">high</option>
					</select>
					</td>
			</tr>
			</table>
		</div>
	
	
	
<!--		<div id='iaxoptions_cdr' style='display: none;'>
			<table class="field_text" align="center" width="100%" cellpadding=3 cellspacing=0 border=0>
			<tr>	<td align=right tip="en,iax_general,6"  width="50%">AMA Flags:</td>
					<td>&nbsp;<input type='text' size=14 id='amaflags' class="input8"></td>
			</tr>
			<tr>	<td align=right tip="en,iax_general,7">Accountcode:</td>
					<td>&nbsp;<input type='text' size=14 id='accountcode' class="input8"></td>
			</tr>
			</table>
		</div>-->
		
		
		
		
		<div id='iaxoptions_jitterBuffer' style='display: none;'>
			<table class="field_text" align="center" width="100%" cellpadding=3 cellspacing=0 border=0>
			<tr>	<td align=right tip="en,iax_general,12" width="50%">Enable Jitter Buffer:</td>
					<td><input type='checkbox' id='jitterbuffer'></td>
			</tr>
			
			<tr>	<td align=right tip="en,iax_general,13">Force Jitter Buffer:</td>
					<td><input type='checkbox' id='forcejitterbuffer'></td>
			</tr>
			<tr>	<td align=right tip="en,iax_general,14">Drop Count:</td>
					<td>&nbsp;<input type='text' size=4 id='dropcount' pattern='^\d*$' class="input8"></td>
			</tr>
			<tr>	<td align=right tip="en,iax_general,15">Max Jitter Buffer:</td>
					<td>&nbsp;<input type='text' size=4 id='maxjitterbuffer' dfalt='1000' pattern='^\d*$' class="input8"></td>
			</tr>
			<tr>	<td align=right tip="en,iax_general,16">Max Interpolation Frames:</td>
					<td>&nbsp;<input type='text' size=4 id='maxjitterinterps' dfalt='10' pattern='^\d*$' class="input8"></td>
			</tr>
			<tr>	<td align=right tip="en,iax_general,17">Resync Threshold:</td>
					<td>&nbsp;<input type='text' size=4 id='resyncthreshold' dfalt='1000' pattern='^\d*$' class="input8"></td>
			</tr>
			<tr>	<td align=right tip="en,iax_general,18">Max Excess Buffer:</td>
					<td>&nbsp;<input type='text' size=4 id='maxexcessbuffer' pattern='^\d*$' class="input8"></td>
			</tr>
			<tr>	<td align=right tip="en,iax_general,19">Min Excess Buffer:</td>
					<td>&nbsp;<input type='text' size=4 id='minexcessbuffer' pattern='^\d*$' class="input8"></td>
			</tr>
			<tr>	<td align=right tip="en,iax_general,20">Jitter Shrink Rate:</td>
					<td>&nbsp;<input type='text' size=4 id='jittershrinkrate' pattern='^\d*$' class="input8"></td>
			</tr>
			</table>
		</div>
	
	
	
		<div id='iaxoptions_trunkregistration' style='display: none;'>
			<table class="field_text" align="center" width="100%" cellpadding=3 cellspacing=0 border=0>
			<tr>	<td colspan=2 align=center><B>IAX Registration Options</B></td></tr>
			<tr>	<td align=right tip="en,iax_general,23"  width="50%">Min Reg Expire:</td>
					<td>&nbsp;<input type='text' size=4 id='minregexpire' dfalt='60'  pattern='^\d*$' class="input8"></td>
			</tr>
			<tr>	<td align=right tip="en,iax_general,24">Max Reg Expire:</td>
					<td>&nbsp;<input type='text' size=4 id='maxregexpire' dfalt='60' pattern='^\d*$' class="input8"></td>
			</tr>
			<tr>	<td align=right tip="en,iax_general,25">IAX ThreadCount:</td>
					<td>&nbsp;<input type='text' size=4 id='iaxthreadcount' dfalt='10' pattern='^\d*$' class="input8"></td>
			</tr>
			<tr>	<td align=right tip="en,iax_general,26">IAX Max ThreadCount:</td>
					<td>&nbsp;<input type='text' size=4 id='iaxmaxthreadcount' dfalt='100' pattern='^\d*$' class="input8"></td>
			</tr>
			<tr>	<td align=right tip="en,iax_general,29">Auto Kill:</td>
					<td>&nbsp;<input size=3 type='text' id='autokill' class="input8"></td>
			</tr>
			
			<tr>	<td align=right tip="en,iax_general,30"><NOBR>Authentication Debugging:</NOBR></td>
					<td><input type='checkbox' id='authdebug'></td>
			</tr>
			<tr>	<td align=right  tip="en,iax_general,31">Codec Priority:</td>
					<td>&nbsp;<select id="codecpriority" dfalt='reqonly' class="input8">
							<option value="caller">caller</option>
							<option value="disabled">disabled</option>
							<option value="reqonly">reqonly</option>
						</select>
					</td>
			</tr>
			<tr>	<td align=right  tip="en,iax_general,32">Type of Service:</td>
					<td>&nbsp;<select size=1 id="tos" class="input8">
						<option value='ef'>ef</option>
						<option value='CS0'>CS0</option>
						<option value='CS1'>CS1</option>
						<option value='CS2'>CS2</option>
						<option value='CS3'>CS3</option>
						<option value='CS4'>CS4</option>
						<option value='CS5'>CS5</option>
						<option value='CS6'>CS6</option>
						<option value='CS7'>CS7</option>
						<option value='AF11'>AF11</option>
						<option value='AF12'>AF12</option>
						<option value='AF13'>AF13</option>
						<option value='AF21'>AF21</option>
						<option value='AF22'>AF22</option>
						<option value='AF23'>AF23</option>
						<option value='AF31'>AF31</option>
						<option value='AF32'>AF32</option>
						<option value='AF33'>AF33</option>
						<option value='AF41'>AF41</option>
						<option value='AF42'>AF42</option>
						<option value='AF43'>AF43</option>
						</select>
					</td>
			</tr>
			<tr>	<td colspan=2 align=center><BR><B>IAX Trunking Options</B></td></tr>
			<tr>	<td align=right tip="en,iax_general,21">Trunk Freq:</td>
					<td>&nbsp;<input type='text' size=4 id='trunkfreq' dfalt='20' pattern='^\d*$' class="input8"></td>
			</tr>
			<tr>	<td align=right tip="en,iax_general,22">Trunk Time Stamps:</td>
					<td><input type='checkbox' id='trunktimestamps' dfalt='n'></td>
			</tr>
			</table>
		</div>
	
	
		
		<!--<div id='iaxoptions_realtime' style='display: none;'>
			<table class="field_text" align="center" width="100%" cellpadding=3 cellspacing=0 border=0>
			<tr>	<td align=right  tip="en,iax_general,33"  width="50%">Cache Friends:</td>
					<td><input type='checkbox' id='rtcachefriends'></td>
			</tr>
			<tr>	<td align=right  tip="en,iax_general,34">Send Registry Updates:</td>
					<td><input type='checkbox' id='rtupdate'></td>
			</tr>
			<tr>	<td align=right  tip="en,iax_general,35">Auto-Expire Friends:</td>
					<td><input type='checkbox' id='rtautoclear'></td>
			</tr>
			<tr>	<td align=right  tip="en,iax_general,36">Ignore Expired Peers:</td>
					<td><input type='checkbox' id='rtignoreexpire'></td>
			</tr>
			</table>
		</div>-->
		
		<div id='iaxoptions_Codecs' style='display: none;'>
			<table class="field_text" align="center" width="100%" cellpadding=3 cellspacing=0 border=0>
			<tr>
				<td align=right>Allowed Codecs:</td>
				<td>&nbsp;<span id='allow'></span></td>
			</tr>
			</table>
		</div>
	
		
		<div style='margin-top:15px; width:100%; text-align:center;'>
			<span class='guiButtonCancel' onclick='window.location.reload();' style='margin-left:10px'>Cancel</span>
			<span class='guiButtonEdit' onclick='saveChanges();'>Save</span>
		</div>
	
	</div>

</center>
</body>
