<!--
 * Asterisk-GUI	- an Asterisk configuration interface
 *
 * Display key system information
 *
 * Copyright (C) 2006-2008, Digium, Inc.
 *
 * Pari Nannapaneni <pari@digium.com>
 * Brandon Kruse <bkruse@digium.com>
 *
 * See http://www.asterisk.org for more information about
 * the Asterisk project. Please do not directly contact
 * any of the maintainers of this project for assistance;
 * the project provides a web site, mailing lists and IRC
 * channels for your use.
 *
 * This program is free software, distributed under the terms of
 * the GNU General Public License Version 2. See the LICENSE file
 * at the top of the source tree.
 *
 -->
<script src="js/jquery.js"></script>
<script src="js/astman.js"></script>
<link href="stylesheets/schwing.css" media="all" rel="Stylesheet" type="text/css" />
<style type="text/css">

</style>
<script>
var COUNTDOWN = 10;
var CPU_USAGE = [];

var getsysinfohtml = function(){
	_$('sysinfohtml').innerHTML = ASTGUI.loadHTML(ASTGUI.paths.output_SysInfo);
	_$('osversion').innerHTML = _$('si_uname').innerHTML;
	_$('uptime').innerHTML = _$('si_uptime').innerHTML.replace(/load average/, "<BR>Load Average");
	_$('asterisk').innerHTML =  parent.sessionData.AsteriskVersionString + "<BR>" + "Asterisk GUI-version : " + ( parent.sessionData.gui_version || ASTGUI.globals.version ) ;
	_$('today').innerHTML = _$('si_date').innerHTML ;
	_$('hostname').innerHTML =_$('si_hostname').innerHTML;
	$('#tabbedMenu').find('A:eq(0)').click();
};

var localajaxinit = function(){
	top.document.title = 'System Information' ;
	parent.ASTGUI.dialog.waitWhile('Loading system Information ...');

	(function(){
		var t = [{	url:'#',
				desc:'General',
				click_function: function(){
					$('.hideall').hide();
					$('#osversion_div').show();
					$('#uptime_div').show();
					$('#asterisk_div').show();
					$('#today_div').show();
					$('#hostname_div').show();
				}
			},{	url: '#',
				desc: 'Network',
				click_function: function(){
					$('.hideall').hide();
					ASTGUI.systemCmdWithOutput( 'ifconfig' , function(output){
						_$('ifconfig').innerHTML = '<pre>' + output +'</pre>' ;
						$('.hideall').hide();
						$('#ifconfig_div').show();
					});
				}
			},{	url: '#',
				desc: 'Disk Usage',
				click_function: function(){
					$('.hideall').hide();
					ASTGUI.systemCmdWithOutput( 'df -k' , function(output){
						_$('diskusage').innerHTML = '<pre>' + output +'</pre>';
						$('.hideall').hide();
						$('#df_div').show();
					});
				}
			},{	url: '#',
				desc: 'Memory Usage',
				click_function: function(){
					$('.hideall').hide();
					ASTGUI.systemCmdWithOutput( 'free' , function(free){
						_$('memoryusage').innerHTML = '<pre>' + free +'</pre>';
						$('.hideall').hide();
						$('#memory_div').show();
					});
				}
			}
// 			,{	url: '#',
// 				desc: 'CPU Usage',
// 				click_function: function(){
// 					$('.hideall').hide();
// 					$('cpu_div').show();
// 				}
// 			}
			];
		ASTGUI.tabbedOptions( _$('tabbedMenu') , t );
	})();
	parent.ASTGUI.systemCmd( parent.ASTGUI.scripts.SysInfo, function(){ parent.ASTGUI.dialog.hide(); getsysinfohtml(); } );

// 	setInterval( function(){
// 		var last_cpu_idle;
// 		var last_cpu_total;
// 
// 		ASTGUI.systemCmdWithOutput( 'head -n 1 /proc/stat', function(stat_op){
// 			var data = stat_op.trim().split(/\s+/);
// 			var tot = parseInt(data[1]) + parseInt(data[2]) + parseInt(data[3]) + parseInt(data[4]) ;
// 			var idle = parseInt(data[4]);
// 
// 			var cpu = 100 - Math.floor( (100 * idle)/tot );
// 			CPU_USAGE.push(cpu);
// 			console.log(cpu);
// 		});
// 
// 		if( COUNTDOWN == 0 ){
// 			updateCPU_Graph();
// 			return;
// 		}
// 
// 		COUNTDOWN--;
// 	}, 1100);
};

var updateCPU_Graph = function(){
	// update graph
	COUNTDOWN = 10;

};

</script>
<body bgcolor="EFEFEF">
<div id="sysinfohtml" style="display:none"></div>

<div class="iframeTitleBar"> System Information <span style="cursor: pointer; cursor: hand;" onclick="window.location.reload();" >&nbsp;<img src="images/refresh.png" title=" Refresh " border=0 >&nbsp;</span> </div>

<div id="tabbedMenu"></div>

<div id="information" style="margin-left: 20px; margin-top: 10px; width: 95%">
	<div id="osversion_div" style="display:none" class='hideall'>
		<B>OS Version:</B> <div id="osversion" style="font-family:courier; font-size:10pt;"></div><BR>
	</div>
	<div id="uptime_div" style="display:none" class='hideall'>
		<B>Uptime:</B> <div id="uptime" style="font-family:courier; font-size:10pt;"></div><BR>
	</div>
	<div id="asterisk_div" style="display:none" class='hideall'>
		<B>Asterisk Build:</B> <div id="asterisk" style="font-family:courier; font-size:10pt;"></div><BR>
	</div>
	<div id="today_div" style="display:none" class='hideall'>
		<B>Server Date & TimeZone:</B><span id="today" style="font-family:courier; font-size:10pt; padding:0px 0px 5px 5px;"></span><BR><BR>
	</div>
	<div id="hostname_div" style="display:none" class='hideall'>
		<B>Hostname:</B> <div id="hostname" style="font-family:courier; font-size:10pt;"></div><BR>
	</div>
	<div id="ifconfig_div" style="display:none;" class='hideall'>
		<div id="ifconfig" style="font-family:courier; font-size:9pt;overflow :auto;"></div>
	</div>
	<div id="df_div" style="display:none;" class='hideall'>
		<B>Disk Usage:</B><div id="diskusage" style="font-family:courier; font-size:10pt;"></div>
	</div>
	<div id="memory_div" style="display:none;" class='hideall'>
		<B>Memory Usage:</B><div id="memoryusage" style="font-family:courier; font-size:9.5pt;"></div>
	</div>
	<div id="cpu_div" style="display:none;" class='hideall'>
		<B>CPU Usage:</B><BR>
		<TABLE id="GRAPH_CPU" cellpadding=0 cellspacing=0 border=0></TABLE>
	</div>
</div>

</body>
