<!--
 * Asterisk-GUI	- an Asterisk configuration interface
 *
 * Manage Digium Partnered VOIP Service Provider  trunks
 *
 * Copyright (C) 2006 - 2008, Digium, Inc.
 *
 * Pari Nannapaneni <pari@digium.com>
 *
 * See http://www.asterisk.org for more information about
 * the Asterisk project. Please do not directly contact
 * any of the maintainers of this project for assistance;
 * the project provides a web site, mailing lists and IRC
 * channels for your use.
 *
 * This program is free software, distributed under the terms of
 * the GNU General Public License Version 2. See the LICENSE file
 * at the top of the source tree.
 *
-->
<script src="js/jquery.js"></script>
<script src="js/astman.js"></script>
<link href="stylesheets/schwing.css" media="all" rel="Stylesheet" type="text/css" />
<style type="text/css">

	#table_SPS_list {
		border: 0px solid #666666;
		margin-top: 8px;
		padding : 1px;
		width: 96%;
	}

	#table_SPS_list {
		border: 1px solid #666666;
		margin-top: 5px;
		margin-bottom:10px;
		width: 96%;
		text-align: center;
		padding : 1px;
	}
	#table_SPS_list tr.frow { background: #6b79a5; color: #CED7EF; }
	#table_SPS_list tr.frow td{ font-weight:bold; }
	#table_SPS_list tr td{ padding : 3px; }
	#table_SPS_list tr.even { background: #DFDFDF; }
	#table_SPS_list tr.odd{ background: #FFFFFF; }
	#table_SPS_list tr.even:hover, #table_SPS_list tr.odd:hover {
		background: #a8b6e5;
		cursor: default;
	}


#TD_SP_desc {
	padding: 10px;
	padding-bottom: 20px;
}


#div_INR_LIST {
	text-align:left;
	height:200px;
	width:96%;
	border-width: 1px;
	border-color: #7E5538;
	border-style: solid;
	overflow: auto;
}

#div_INR_LIST div {
	clear: both;
	padding : 3px 5px 0px 5px;
	min-height: 20px;
}

#div_INR_LIST div:hover{
	background-color:#DEDEDE;
}

#div_INR_LIST div span.rule_desc {
	padding: 2px 3px 2px 5px;
	float: left;
	background: transparent;
}

#div_INR_LIST div span.rule_delete {
	float: right;
	width: 20px;
	background: transparent url("./images/delete_circle.png") no-repeat;
}

</style>
<script>
var PROVIDERS_URL = 'https://gui-dl.digium.com/providers.js';

loaded_external = false;
var WARNING_MESSAGE = "The service provider information used in this product is downloaded on demand from Digium's web site. "
+ "This download occurs over a secure (SSL)"
+ "connection, ensuring that only safe, tested and supported service provider information will be used.<BR><BR>"
+ "Your web browser should not display any 'insecure connection' or 'unverified certificate' warnings "
+ "when this download occurs. If you see any messages of this type when using the"
+ "'Service Providers' page, you should not allow your browser to proceed with the information download, as the"
+ "security of your connection may have been compromised.<BR><BR>"
+ "For your convenience, this warning message will only be displayed the first time you use the 'Service Providers' page in this product. "
+ "If you choose to continue beyond this point, the system will remember that you have seen this warning message and will not display it again.";


var localajaxinit = function(){
	top.document.title = 'Service Providers' ;
	(function(){
		var R = [];
		R.push( {optionText:'None', optionValue :'' } );
		for ( var r in parent.sessionData.listOfCodecs ){
			R.push( {optionText: parent.sessionData.listOfCodecs[r] , optionValue : r });
		}
		ASTGUI.selectbox.populateArray('codec_one', R);
		ASTGUI.selectbox.populateArray('codec_two', R);
		ASTGUI.selectbox.populateArray('codec_three', R);
		ASTGUI.selectbox.populateArray('codec_fourth', R);
		ASTGUI.selectbox.populateArray('codec_fifth', R);
	})();
	(function (){
		var t = [ ];
		if( !parent.sessionData.PLATFORM.AA50_SKU.contains('800') ){
			t.push({ url: 'trunks_analog.html', desc: 'Analog Trunks' });
		};
		t.push({url:'#', desc:'Service Providers', selected:true });
		t.push({url:'trunks_voip.html', desc:'VOIP Trunks'});
		if( !parent.sessionData.PLATFORM.isAA50 ){
			t.push({url:'trunks_digital.html', desc:'T1/E1/BRI Trunks'});
		}
		ASTGUI.tabbedOptions( _$('tabbedMenu') , t);
	})();

	var LOAD_Providers = function(){
		parent.ASTGUI.dialog.waitWhile(' Loading Providers configuration info ...');
		$.getScript( PROVIDERS_URL , function(tmp_script_status){
			if(tmp_script_status == 404){
				parent.ASTGUI.dialog.hide();
				_$('unableToLoadProviders_container').style.display = '';
				return;
			}
			if(loaded_external){
				whenThisFileisLoaded(); // this function is defined in the loaded file
			}
		});
		(function (){
			var oops = function(){
				if(loaded_external){return;}
				parent.ASTGUI.dialog.hide();
				_$('unableToLoadProviders_container').style.display = '';
				//alert("Failed loading providers configuration");
			};
			setTimeout( oops , 30000 ); // if not loaded with in 10 seconds - then consider as failed
		})();
	};

	var gp = config2json({filename: ASTGUI.globals.configfile, usf:1});
	if( gp.hasOwnProperty('general') && gp['general'].getProperty('warning_providers') == 'yes' ){
		LOAD_Providers();
	}else{
		parent.ASTGUI.yesOrNo({
			msg: WARNING_MESSAGE ,
			ifyes: function(){
				ASTGUI.updateaValue({ file:ASTGUI.globals.configfile , context :'general', variable :'warning_providers', value :'yes' });
				LOAD_Providers();
			},
			ifno:function(){
				ASTGUI.feedback( { msg:'Aborted loading Providers', showfor:2 });
			},
			title : 'Security Warning !',
			btnYes_text :'Continue',
			btnNo_text : 'Cancel',
			dialogWidth: 600,
			dialogHeight: 330
		});
	}

}

</script>
<body bgcolor="EFEFEF">
<div class="iframeTitleBar"> 
	Manage Service Providers
	<span style="cursor: pointer; cursor: hand;" onclick="window.location.reload();" >&nbsp;<img src="images/refresh.png" title=" Refresh " border=0 >&nbsp;</span>
</div>

<div id="tabbedMenu"></div>

<div class='top_buttons' style="margin-top: -10px; display:none;">
	<span id='new_SP_button' class='guiButtonNew' onclick='misc_SP_Functions.show_newSP_form();'>New ServiceProvider</span>
</div>

<div style='display:none; width:95%; text-align:center;' id='unableToLoadProviders_container'>
		<div>
			<BR><BR>
			Could not load providers configuration. <BR>
			Please make sure that your computer is connected to the internet and try again.<BR><BR>
		</div>
		<span id='new_SP_button' class='guiButton' onclick='window.location.reload();'>&nbsp;&nbsp; Try Again &nbsp;&nbsp;</span>
</div>

<table id='table_SPS_list' cellpadding=0 cellspacing=0 border=0 align=center></table>

<div id="new_SPTrunk_DIV" STYLE="width:650; max-height:450;display:none;" class='dialog'>
	<TABLE width="100%" cellpadding=0 cellspacing=0>
	<TR class="dialog_title_tr">
		<TD class="dialog_title" onmousedown="ASTGUI.startDrag(event);">
			<span id='new_SP_DIV_Title'>Add New Service Provider</span>
		</TD>
		<TD class="dialog_title_X" onclick="ASTGUI.hideDrag(event);"> X </TD>
	</TR>
	</TABLE>

	<TABLE	align=center cellpadding=2 cellspacing=2 border=0 width='100%'>

	<TR>	<TD align="center" width='50%'>Choose a Service Provider &darr;</TD>
		<TD></TD>
	</TR>

	<TR>	<TD align="center">
			<select id='new_SP_Provider' style='width:250px' size=5></select>
		</TD>
		<TD id="TD_SP_Logo_container" align="center"></TD>
	</TR>

	<TR>	<TD align="center" id="TD_SP_desc" colspan=2></TD>
	</TR>
	<TR class='TR_SP_UP'>
		<TD align="right">Username:</TD>
		<TD align="left"><input size=12 id='input_sp_uname'></TD>
	</TR>
	<TR class='TR_SP_UP'>
		<TD align="right">Password:</TD>
		<TD align="left"><input size=12 id='input_sp_password'></TD>
	</TR>

<!--	<TR class='TR_SP_FB'>	<TD align="right">
			All unmatched incoming calls go to:
		</TD>
		<TD>
			<select id="new_SP_fb"></select>
		</TD>
	</TR>-->
	<TR>	<TD colspan=2 align=center height=50 valign=middle>
			<span class='guiButtonCancel' onclick='ASTGUI.hideDrag(event);'>Cancel</span>
			<span class='guiButtonEdit' id="new_SP_save" onclick='create_new_serviceProvider();'>Add</span>
		</TD>
	</TR>
	</TABLE>
</div>




<div id="Edit_SPTrunk_DIV" STYLE="width:550; display:none;" class='dialog'>
	<TABLE width="100%" cellpadding=0 cellspacing=0>
		<TR class="dialog_title_tr">
			<TD class="dialog_title" onmousedown="ASTGUI.startDrag(event);">
				<span id='edit_SP_DIV_Title'>Edit Service Provider</span>
			</TD>
			<TD class="dialog_title_X" onclick="ASTGUI.hideDrag(event);"> X </TD>
		</TR>
	</TABLE>
	<TABLE	align=center cellpadding=3 cellspacing=2 border=0 width='100%'>
		<TR>	<TD align="right">Username :</TD>
			<TD align="left"><input size=26 id='edit_sp_uname'></TD>
		</TR>
		<TR>	<TD align="right">Password :</TD>
			<TD align="left"><input size=26 id='edit_sp_password'></TD>
		</TR>
		<TR>	<TD align="right" valign=top>CallerID :</TD>
			<TD align="left"><input id='edit_trunk_obcid' size=12></TD>
		</TR>
		<TR>	<TD align="right" valign=top>Codecs :</TD>
			<TD align="left">
				First : <select id='codec_one'></select>
				Second : <select id='codec_two'></select>
				Third : <select id='codec_three'></select><BR>
				Fourth : <select id='codec_fourth'></select>
				Fifth : <select id='codec_fifth'></select>
			</TD>
		</TR>
		<TR>	<TD colspan=2 align=center height=50 valign=middle>
				<span class='guiButtonCancel' onclick='ASTGUI.hideDrag(event);'>Cancel</span>
				<span class='guiButtonEdit' id="new_SP_save" onclick='misc_SP_Functions.edit_trunk_save();'>Update</span>
			</TD>
		</TR>
	</TABLE>
</div>


</body>
